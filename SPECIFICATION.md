# Hi & Low ã‚²ãƒ¼ãƒ  - æŠ€è¡“ä»•æ§˜æ›¸

> ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¯ã€ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’å®Œå…¨ã«å†ç¾ã™ã‚‹ãŸã‚ã®è©³ç´°ãªæŠ€è¡“ä»•æ§˜ã§ã™ã€‚

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

| é …ç›®               | å€¤                                       |
| ------------------ | ---------------------------------------- |
| **åç§°**           | Hi & Low Game                            |
| **ãƒãƒ¼ã‚¸ãƒ§ãƒ³**     | 1.0.0ï¼ˆãƒ­ãƒƒã‚¯ãƒ€ã‚¦ãƒ³æ¸ˆã¿ï¼‰                |
| **ç”¨é€”**           | ãƒˆãƒ©ãƒ³ãƒ—ã‚’ä½¿ã£ãŸãƒã‚¤ï¼†ãƒ­ãƒ¼ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ    |
| **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£** | ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ™ãƒ¼ã‚¹é–‹ç™ºï¼ˆå³æ ¼ãªå¢ƒç•Œç®¡ç†ï¼‰ |
| **ãƒ©ã‚¤ã‚»ãƒ³ã‚¹**     | MIT                                      |

## 1.1 ã‚²ãƒ¼ãƒ æ¦‚è¦

**Hi & Low**ã¯ã€æ¬¡ã®ã‚«ãƒ¼ãƒ‰ãŒç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ã‚ˆã‚Šã€Œé«˜ã„ã€ã‹ã€Œä½ã„ã€ã‹ã‚’äºˆæƒ³ã™ã‚‹ã‚·ãƒ³ãƒ—ãƒ«ãªã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ ã§ã™ã€‚

### ã‚²ãƒ¼ãƒ ãƒ«ãƒ¼ãƒ«

1. ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¯åˆæœŸã‚³ã‚¤ãƒ³10æšã§ã‚¹ã‚¿ãƒ¼ãƒˆ
2. 1ã‚²ãƒ¼ãƒ ã«ã¤ã1ã‚³ã‚¤ãƒ³ã‚’æ¶ˆè²»
3. æ¬¡ã®ã‚«ãƒ¼ãƒ‰ãŒç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ã‚ˆã‚Šé«˜ã„ï¼ˆHIGHï¼‰ã‹ä½ã„ï¼ˆLOWï¼‰ã‹ã‚’äºˆæƒ³
4. æ­£è§£ã™ã‚‹ã¨é€£å‹æ•°åˆ†ã®ã‚³ã‚¤ãƒ³ã‚’ç²å¾—
5. åŒã˜æ•°å­—ï¼ˆãƒ‰ãƒ­ãƒ¼ï¼‰ã®å ´åˆã¯ã‚³ã‚¤ãƒ³ãŒè¿”å´ã•ã‚Œã‚‹
6. ä¸æ­£è§£ã§ã‚‚é€£å‹ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ã ã‘ã§ç¶šè¡Œå¯èƒ½
7. ã‚³ã‚¤ãƒ³ãŒ0ã«ãªã‚‹ã¨ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼

### ã‚«ãƒ¼ãƒ‰å€¤ã®é †åº

```
A(1) < 2 < 3 < 4 < 5 < 6 < 7 < 8 < 9 < 10 < J(11) < Q(12) < K(13)
```

## 2. æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯

### 2.1 ã‚³ã‚¢ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€”                              |
| ---------- | ---------- | --------------------------------- |
| Next.js    | ^15.3.3    | Reactãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆApp Routerï¼‰ |
| React      | ^19.1.0    | UIãƒ©ã‚¤ãƒ–ãƒ©ãƒª                      |
| React DOM  | ^19.1.0    | DOMãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°                   |
| TypeScript | ^5.8.3     | å‹å®‰å…¨ãªé–‹ç™º                      |

### 2.2 ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸   | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€”                           |
| ------------ | ---------- | ------------------------------ |
| Tailwind CSS | ^3.4.17    | ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ãƒ•ã‚¡ãƒ¼ã‚¹ãƒˆCSS    |
| PostCSS      | ^8.5.3     | CSSãƒ—ãƒ­ã‚»ãƒƒã‚µ                  |
| Autoprefixer | ^10.4.21   | ãƒ™ãƒ³ãƒ€ãƒ¼ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹è‡ªå‹•ä»˜ä¸ |

### 2.3 çŠ¶æ…‹ç®¡ç†ãƒ»ãƒ‡ãƒ¼ã‚¿

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸            | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€”                 |
| --------------------- | ---------- | -------------------- |
| Zustand               | ^5.0.5     | è»½é‡çŠ¶æ…‹ç®¡ç†         |
| @supabase/supabase-js | ^2.49.4    | Supabaseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ |

### 2.4 å›½éš›åŒ–

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸    | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€”                      |
| ------------- | ---------- | ------------------------- |
| i18next       | ^25.2.1    | å›½éš›åŒ–ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯      |
| react-i18next | ^16.4.1    | Reactç”¨i18nãƒã‚¤ãƒ³ãƒ‡ã‚£ãƒ³ã‚° |
| next-i18next  | ^15.4.2    | Next.jsç”¨i18nçµ±åˆ         |

### 2.5 ãƒ†ã‚¹ãƒˆ

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸             | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€”                         |
| ---------------------- | ---------- | ---------------------------- |
| Vitest                 | ^3.1.4     | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ |
| @testing-library/react | ^16.3.0    | Reactã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ    |
| Playwright             | ^1.52.0    | E2Eãƒ†ã‚¹ãƒˆ                    |

### 2.6 å“è³ªç®¡ç†

| ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸  | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ç”¨é€”                   |
| ----------- | ---------- | ---------------------- |
| ESLint      | ^9.28.0    | ã‚³ãƒ¼ãƒ‰å“è³ªãƒã‚§ãƒƒã‚¯     |
| Prettier    | ^3.5.3     | ã‚³ãƒ¼ãƒ‰ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ     |
| Husky       | ^9.1.7     | Git hooksç®¡ç†          |
| lint-staged | ^16.1.0    | ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ•ã‚¡ã‚¤ãƒ«ã®lint |

## 3. ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
template-v3.0/
â”œâ”€â”€ .claude/                    # Claude Codeè¨­å®š
â”‚   â”œâ”€â”€ settings.json          # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šï¼ˆGitç®¡ç†ï¼‰
â”‚   â””â”€â”€ settings.local.json    # ãƒ­ãƒ¼ã‚«ãƒ«è¨­å®šï¼ˆGité™¤å¤–ï¼‰
â”œâ”€â”€ .github/
â”‚   â””â”€â”€ workflows/             # GitHub Actions
â”œâ”€â”€ .husky/                    # Git hooks
â”‚   â”œâ”€â”€ pre-commit            # ã‚³ãƒŸãƒƒãƒˆå‰ãƒã‚§ãƒƒã‚¯
â”‚   â””â”€â”€ commit-msg            # ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¤œè¨¼
â”œâ”€â”€ docs/                      # ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
â”œâ”€â”€ scripts/                   # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”‚   â”œâ”€â”€ setup.js              # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
â”‚   â”œâ”€â”€ check.js              # å“è³ªãƒã‚§ãƒƒã‚¯
â”‚   â”œâ”€â”€ check-boundaries.js   # å¢ƒç•Œé•åæ¤œå‡º
â”‚   â”œâ”€â”€ create-feature.js     # ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ä½œæˆ
â”‚   â””â”€â”€ preflight.js          # ãƒ‡ãƒ—ãƒ­ã‚¤å‰ãƒã‚§ãƒƒã‚¯
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                  # Next.js App Router
â”‚   â”‚   â”œâ”€â”€ layout.tsx        # ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ
â”‚   â”‚   â””â”€â”€ page.tsx          # ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸
â”‚   â”œâ”€â”€ components/           # å…±æœ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”‚   â”‚   â””â”€â”€ ErrorBoundary.tsx # ã‚¨ãƒ©ãƒ¼å¢ƒç•Œ
â”‚   â”œâ”€â”€ features/             # ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
â”‚   â”‚   â””â”€â”€ _template/        # ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
â”‚   â”œâ”€â”€ hooks/                # å…±æœ‰ãƒ•ãƒƒã‚¯
â”‚   â”‚   â”œâ”€â”€ useI18n.ts        # å›½éš›åŒ–ãƒ•ãƒƒã‚¯
â”‚   â”‚   â””â”€â”€ useInfiniteLoopDetector.ts
â”‚   â”œâ”€â”€ styles/               # ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚¿ã‚¤ãƒ«
â”‚   â”‚   â””â”€â”€ globals.css       # Tailwind CSS
â”‚   â””â”€â”€ utils/                # ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”‚       â”œâ”€â”€ cache/            # ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ©Ÿèƒ½
â”‚       â””â”€â”€ error-handling/   # ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ e2e/                  # E2Eãƒ†ã‚¹ãƒˆ
â”‚   â”‚   â”œâ”€â”€ fixtures/         # ãƒ†ã‚¹ãƒˆãƒ•ã‚£ã‚¯ã‚¹ãƒãƒ£
â”‚   â”‚   â””â”€â”€ helpers/          # ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼
â”‚   â”œâ”€â”€ regression/           # å›å¸°ãƒ†ã‚¹ãƒˆ
â”‚   â””â”€â”€ unit/                 # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
â”œâ”€â”€ CLAUDE.md                 # Claude Codeå®Ÿè£…ã‚¬ã‚¤ãƒ‰
â”œâ”€â”€ PROJECT_INFO.md           # ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæƒ…å ±
â”œâ”€â”€ SETUP_GUIDE.md            # ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰
â”œâ”€â”€ package.json              # ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸è¨­å®š
â”œâ”€â”€ tsconfig.json             # TypeScriptè¨­å®š
â”œâ”€â”€ tailwind.config.ts        # Tailwindè¨­å®š
â”œâ”€â”€ next.config.mjs           # Next.jsè¨­å®š
â”œâ”€â”€ vitest.config.ts          # Vitestè¨­å®š
â””â”€â”€ playwright.config.ts      # Playwrightè¨­å®š
```

## 4. ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒ™ãƒ¼ã‚¹é–‹ç™º

### 4.1 ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼æ§‹é€ 

```
src/features/[feature-name]/
â”œâ”€â”€ api/              # APIé–¢æ•°ï¼ˆå…¬é–‹æ¨å¥¨ï¼‰
â”‚   â””â”€â”€ featureApi.ts
â”œâ”€â”€ components/       # UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆå†…éƒ¨ä½¿ç”¨ã®ã¿ï¼‰
â”‚   â””â”€â”€ Component.tsx
â”œâ”€â”€ hooks/            # ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼ˆå†…éƒ¨ä½¿ç”¨ã®ã¿ï¼‰
â”‚   â””â”€â”€ useFeature.ts
â”œâ”€â”€ types/            # å‹å®šç¾©
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ utils/            # ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ï¼ˆå†…éƒ¨ä½¿ç”¨ã®ã¿ï¼‰
â”œâ”€â”€ store/            # çŠ¶æ…‹ç®¡ç†ï¼ˆå†…éƒ¨ä½¿ç”¨ã®ã¿ï¼‰
â”œâ”€â”€ __tests__/        # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«
â””â”€â”€ index.ts          # å…¬é–‹APIï¼ˆæœ€å°é™ï¼‰
```

### 4.2 å¢ƒç•Œãƒ«ãƒ¼ãƒ«ï¼ˆçµ¶å¯¾éµå®ˆï¼‰

| ãƒ«ãƒ¼ãƒ«                 | èª¬æ˜                                    |
| ---------------------- | --------------------------------------- |
| ãƒ•ãƒƒã‚¯éå…¬é–‹           | `index.ts`ã‹ã‚‰ãƒ•ãƒƒã‚¯ã‚’çµ¶å¯¾ã«å…¬é–‹ã—ãªã„  |
| UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆéå…¬é–‹ | å„ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãŒç‹¬è‡ªUIã‚’å®Ÿè£…            |
| APIé–¢æ•°å…¬é–‹            | ãƒ‡ãƒ¼ã‚¿å–å¾—ã¯ç´”ç²‹é–¢æ•°ã¨ã—ã¦å…¬é–‹          |
| importå½¢å¼             | `@/features/[name]`ã®ã¿ä½¿ç”¨å¯èƒ½         |
| å†…éƒ¨ã‚¢ã‚¯ã‚»ã‚¹ç¦æ­¢       | `/components`ã€`/hooks`ã¸ã®ç›´æ¥å‚ç…§ç¦æ­¢ |

### 4.3 æ­£ã—ã„index.tsã®ä¾‹

```typescript
// src/features/[feature-name]/index.ts

// âœ… APIé–¢æ•°ï¼ˆå…¬é–‹æ¨å¥¨ï¼‰
export { getFeatureData, createItem } from './api/featureApi'

// âœ… ãƒ‰ãƒ¡ã‚¤ãƒ³å‹ã®ã¿ï¼ˆå…¬é–‹å¯ï¼‰
export type { FeatureItem, FeatureConfig } from './types'

// âŒ ãƒ•ãƒƒã‚¯ï¼ˆå…¬é–‹ç¦æ­¢ï¼‰
// export { useFeature } from './hooks/useFeature'

// âŒ UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆå…¬é–‹ç¦æ­¢ï¼‰
// export { FeatureComponent } from './components/FeatureComponent'
```

## 5. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä»•æ§˜

### 5.1 TypeScriptè¨­å®šï¼ˆtsconfig.jsonï¼‰

```json
{
  "compilerOptions": {
    "target": "es2020",
    "lib": ["dom", "dom.iterable", "esnext"],
    "strict": true,
    "noImplicitAny": true,
    "strictNullChecks": true,
    "strictFunctionTypes": true,
    "strictBindCallApply": true,
    "noImplicitReturns": true,
    "noFallthroughCasesInSwitch": true,
    "noUnusedLocals": true,
    "noUnusedParameters": true,
    "noImplicitOverride": true,
    "allowUnusedLabels": false,
    "allowUnreachableCode": false,
    "exactOptionalPropertyTypes": false,
    "noUncheckedIndexedAccess": false,
    "strictPropertyInitialization": false,
    "noEmit": true,
    "esModuleInterop": true,
    "module": "esnext",
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "isolatedModules": true,
    "jsx": "preserve",
    "incremental": true,
    "paths": {
      "@/*": ["./src/*"],
      "@features/*": ["./src/features/*"]
    }
  }
}
```

### 5.2 Next.jsè¨­å®šï¼ˆnext.config.mjsï¼‰

```javascript
import bundleAnalyzer from '@next/bundle-analyzer'

const nextConfig = {
  reactStrictMode: true,
}

const withBundleAnalyzer = bundleAnalyzer({
  enabled: process.env.ANALYZE === 'true',
  openAnalyzer: true,
})

export default process.env.ANALYZE === 'true' ? withBundleAnalyzer(nextConfig) : nextConfig
```

### 5.3 Vitestè¨­å®šï¼ˆvitest.config.tsï¼‰

```typescript
import { defineConfig } from 'vitest/config'
import react from '@vitejs/plugin-react'
import path from 'path'

export default defineConfig({
  plugins: [react()],
  test: {
    environment: 'jsdom',
    globals: true,
    setupFiles: './tests/setup.ts',
    include: ['**/*.{test,spec}.{js,jsx,ts,tsx}'],
    exclude: ['node_modules', '.next', 'tests/e2e'],
    coverage: {
      provider: 'v8',
      reporter: ['text', 'json', 'html'],
      thresholds: {
        global: {
          branches: 90,
          functions: 90,
          lines: 90,
          statements: 90,
        },
        'src/features/**/': {
          branches: 95,
          functions: 95,
          lines: 95,
          statements: 95,
        },
      },
    },
  },
  resolve: {
    alias: {
      '@': path.resolve(__dirname, './src'),
      '@/features': path.resolve(__dirname, './src/features'),
    },
  },
})
```

### 5.4 Playwrightè¨­å®šï¼ˆplaywright.config.tsï¼‰

```typescript
import { defineConfig, devices } from '@playwright/test'

export default defineConfig({
  testDir: './tests/e2e',
  fullyParallel: true,
  forbidOnly: process.env.CI === 'true',
  retries: process.env.CI === 'true' ? 2 : 0,
  workers: process.env.CI === 'true' ? 1 : undefined,
  use: {
    baseURL: 'http://localhost:3000',
    trace: 'on-first-retry',
    screenshot: 'only-on-failure',
    video: 'retain-on-failure',
  },
  projects: [
    { name: 'chromium', use: { ...devices['Desktop Chrome'] } },
    { name: 'mobile', use: { ...devices['Pixel 5'] } },
  ],
  webServer: {
    command: process.env.CI === 'true' ? 'pnpm build && pnpm start' : 'pnpm dev',
    url: 'http://localhost:3000',
    reuseExistingServer: false,
    timeout: 120 * 1000,
  },
})
```

### 5.5 Tailwind CSSè¨­å®š

**ãƒ•ã‚©ãƒ³ãƒˆ:**

- `font-rounded`: M PLUS Rounded 1cï¼ˆæ—¥æœ¬èªæœ€é©åŒ–ï¼‰
- `font-mono`: Fira Code
- `font-cyber`: Orbitron
- `font-retro`: Press Start 2P

**ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ:**

- Neon: `neon-green`, `neon-pink`, `neon-blue`, `neon-yellow`, `neon-orange`
- Glass: `glass-white`, `glass-black`
- Bauhaus: `bauhaus-red`, `bauhaus-blue`, `bauhaus-yellow`
- Natural: `earth-brown`, `leaf-green`, `sky-blue`, `sand-beige`

**ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ã‚¯ãƒ©ã‚¹:**

- `.glass`: GlassmorphismèƒŒæ™¯
- `.glass-dark`: ãƒ€ãƒ¼ã‚¯Glassmorphism
- `.neumorphism`: Neumorphismã‚¹ã‚¿ã‚¤ãƒ«
- `.neumorphism-inset`: å†…å´Neumorphism
- `.text-neon`: ãƒã‚ªãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
- `.text-brutal`: Brutalismãƒ†ã‚­ã‚¹ãƒˆ
- `.text-retro`: ãƒ¬ãƒˆãƒ­ãƒ†ã‚­ã‚¹ãƒˆ
- `.text-gradient`: ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ãƒ†ã‚­ã‚¹ãƒˆ

**ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³:**

- `animate-glitch`: ã‚°ãƒªãƒƒãƒã‚¨ãƒ•ã‚§ã‚¯ãƒˆ
- `animate-pulse-neon`: ãƒã‚ªãƒ³ç‚¹æ»…
- `animate-float`: ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- `animate-gradient-shift`: ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç§»å‹•
- `animate-typing`: ã‚¿ã‚¤ãƒ”ãƒ³ã‚°ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ

### 5.6 ç’°å¢ƒå¤‰æ•°

```bash
# .env.example
NEXT_PUBLIC_APP_NAME=your-app-name
NODE_ENV=development

# ã‚ªãƒ—ã‚·ãƒ§ãƒ³
# NEXT_PUBLIC_API_URL=http://localhost:3000/api
# NEXT_PUBLIC_SUPABASE_URL=your-supabase-url
# NEXT_PUBLIC_SUPABASE_ANON_KEY=your-supabase-anon-key
```

## 6. ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ä»•æ§˜

### 6.1 ãƒ«ãƒ¼ãƒˆãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆsrc/app/layout.tsxï¼‰

```typescript
import type { Metadata } from 'next'
import '@/styles/globals.css'

export const metadata: Metadata = {
  title: 'Feature App',
  description: 'Feature-based development template',
}

export default function RootLayout({
  children,
}: Readonly<{
  children: React.ReactNode
}>) {
  return (
    <html lang="ja">
      <body className="font-rounded">{children}</body>
    </html>
  )
}
```

### 6.2 ãƒ›ãƒ¼ãƒ ãƒšãƒ¼ã‚¸ï¼ˆsrc/app/page.tsxï¼‰

```typescript
export default function Home() {
  return (
    <main className="min-h-screen flex items-center justify-center">
      <p className="text-gray-500 font-rounded">Next.js App Running</p>
    </main>
  )
}
```

### 6.3 ã‚¨ãƒ©ãƒ¼å¢ƒç•Œï¼ˆsrc/components/ErrorBoundary.tsxï¼‰

ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼é–“ã®ã‚¨ãƒ©ãƒ¼ä¼æ’­ã‚’é˜²ãã‚¯ãƒ©ã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚

**Props:**

- `children`: ReactNode
- `fallback?`: ReactNodeï¼ˆã‚«ã‚¹ã‚¿ãƒ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯UIï¼‰
- `featureName?`: stringï¼ˆã‚¨ãƒ©ãƒ¼ç‰¹å®šç”¨ï¼‰

**State:**

- `hasError`: boolean
- `error?`: Error

**æ©Ÿèƒ½:**

- ã‚¨ãƒ©ãƒ¼æ•æ‰ã¨ãƒ­ã‚°å‡ºåŠ›
- é–‹ç™ºç’°å¢ƒã§ã®ã‚¹ã‚¿ãƒƒã‚¯ãƒˆãƒ¬ãƒ¼ã‚¹è¡¨ç¤º
- ã‚«ã‚¹ã‚¿ãƒã‚¤ã‚ºå¯èƒ½ãªãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯UI

### 6.4 å›½éš›åŒ–ãƒ•ãƒƒã‚¯ï¼ˆsrc/hooks/useI18n.tsï¼‰

**å‹å®šç¾©:**

```typescript
type Locale = 'ja' | 'en'
```

**æˆ»ã‚Šå€¤:**

- `locale`: Locale - ç¾åœ¨ã®ãƒ­ã‚±ãƒ¼ãƒ«
- `locales`: Locale[] - åˆ©ç”¨å¯èƒ½ãªãƒ­ã‚±ãƒ¼ãƒ«
- `setLocale`: (newLocale: Locale) => void
- `t`: (key: string) => string - ç¿»è¨³é–¢æ•°

**æ©Ÿèƒ½:**

- ãƒ–ãƒ©ã‚¦ã‚¶è¨€èªè¨­å®šã®è‡ªå‹•æ¤œå‡º
- localStorageæ°¸ç¶šåŒ–
- next-i18nextæ‹¡å¼µæº–å‚™

### 6.5 ç„¡é™ãƒ«ãƒ¼ãƒ—æ¤œå‡ºï¼ˆsrc/hooks/useInfiniteLoopDetector.tsï¼‰

é–‹ç™ºç’°å¢ƒå°‚ç”¨ã®ç„¡é™ãƒ«ãƒ¼ãƒ—æ¤œå‡ºãƒ•ãƒƒã‚¯ã€‚

**ã‚ªãƒ—ã‚·ãƒ§ãƒ³:**

```typescript
interface LoopDetectorOptions {
  name: string // ç›£è¦–å
  threshold?: number // è­¦å‘Šé–¾å€¤ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 10ï¼‰
  timeWindow?: number // ç›£è¦–æ™‚é–“çª“ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5000msï¼‰
  customMessage?: string // ã‚«ã‚¹ã‚¿ãƒ è­¦å‘Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
}
```

**æ©Ÿèƒ½:**

- useEffectå®Ÿè¡Œå›æ•°ã®ç›£è¦–
- ç•°å¸¸é »åº¦ã®æ¤œå‡ºã¨è­¦å‘Š
- ãƒ‡ãƒãƒƒã‚¬ãƒ¼åœæ­¢ã‚ªãƒ—ã‚·ãƒ§ãƒ³
- `logExecutionStats()`ã§ã‚°ãƒ­ãƒ¼ãƒãƒ«çµ±è¨ˆè¡¨ç¤º

### 6.6 ã‚­ãƒ£ãƒƒã‚·ãƒ¥ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ï¼ˆsrc/utils/cache/ï¼‰

**MemoryCacheã‚¯ãƒ©ã‚¹:**

```typescript
class MemoryCache<T> implements IMemoryCache<T> {
  get(key: string): T | undefined
  set(key: string, value: T, options?: CacheOptions): void
  has(key: string): boolean
  delete(key: string): boolean
  clear(): void
  getStats(): CacheStats
  deleteByTag(tag: string): number
  cleanup(): number
  size(): number
}
```

**ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚¹ãƒˆãƒ©ãƒ†ã‚¸ãƒ¼:**

- `lru`: Least Recently Used
- `lfu`: Least Frequently Used
- `fifo`: First In First Out
- `ttl`: Time To Live

**ãƒ—ãƒªã‚»ãƒƒãƒˆ:**

- `CachePresets.api`: APIå¿œç­”ç”¨ï¼ˆçŸ­TTLã€LRUï¼‰
- `CachePresets.session`: ã‚»ãƒƒã‚·ãƒ§ãƒ³ç”¨ï¼ˆé•·TTLï¼‰
- `CachePresets.computation`: è¨ˆç®—çµæœç”¨ï¼ˆTTLãªã—ã€LFUï¼‰
- `CachePresets.static`: é™çš„ãƒªã‚½ãƒ¼ã‚¹ç”¨ï¼ˆå¤§å®¹é‡ï¼‰
- `CachePresets.development`: é–‹ç™ºç”¨ï¼ˆãƒ‡ãƒãƒƒã‚°æœ‰åŠ¹ï¼‰

### 6.7 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆsrc/utils/error-handling/ï¼‰

**æ§‹é€ åŒ–ã‚¨ãƒ©ãƒ¼å‹:**

```typescript
interface StructuredError {
  code?: string
  message: string
  userMessage?: string
  level: 'critical' | 'error' | 'warning' | 'info'
  category: 'network' | 'database' | 'auth' | 'validation' | 'business' | 'system' | 'unknown'
  context?: Record<string, unknown>
  stack?: string
  timestamp: Date
  originalError?: unknown
}
```

**ä¸»è¦é–¢æ•°:**

- `transformError(error, options)`: ã‚¨ãƒ©ãƒ¼å¤‰æ›
- `handleError(error, options)`: ã‚¨ãƒ©ãƒ¼å‡¦ç†ã¨ãƒ­ã‚°
- `tryCatch<T>(operation, options)`: Promiseç”¨ãƒ©ãƒƒãƒ‘ãƒ¼
- `aggregateErrors(errors)`: è¤‡æ•°ã‚¨ãƒ©ãƒ¼é›†ç´„

**Supabaseçµ±åˆ:**

- `isSupabaseError(error)`: Supabaseã‚¨ãƒ©ãƒ¼åˆ¤å®š
- `transformSupabaseError(error)`: Supabaseã‚¨ãƒ©ãƒ¼å¤‰æ›
- `safeSupabaseOperation(operation)`: å®‰å…¨ãªæ“ä½œãƒ©ãƒƒãƒ‘ãƒ¼

## 7. ã‚³ãƒãƒ³ãƒ‰ä¸€è¦§

### 7.1 é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰         | èª¬æ˜                   |
| ---------------- | ---------------------- |
| `pnpm dev`       | é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•       |
| `pnpm build`     | ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ãƒ“ãƒ«ãƒ‰   |
| `pnpm start`     | ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ã‚µãƒ¼ãƒãƒ¼ |
| `pnpm lint`      | ESLintãƒã‚§ãƒƒã‚¯         |
| `pnpm typecheck` | å‹ãƒã‚§ãƒƒã‚¯             |

### 7.2 ãƒ†ã‚¹ãƒˆã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰               | èª¬æ˜               |
| ---------------------- | ------------------ |
| `pnpm test`            | ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ |
| `pnpm test:unit`       | Vitestã§ãƒ†ã‚¹ãƒˆ     |
| `pnpm test:e2e`        | Playwrightã§ãƒ†ã‚¹ãƒˆ |
| `pnpm test:coverage`   | ã‚«ãƒãƒ¬ãƒƒã‚¸æ¸¬å®š     |
| `pnpm test:regression` | å›å¸°ãƒ†ã‚¹ãƒˆ         |

### 7.3 å“è³ªç®¡ç†ã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰                | èª¬æ˜               |
| ----------------------- | ------------------ |
| `pnpm check`            | åŒ…æ‹¬çš„å“è³ªãƒã‚§ãƒƒã‚¯ |
| `pnpm check:boundaries` | å¢ƒç•Œé•åæ¤œå‡º       |
| `pnpm fix:boundaries`   | å¢ƒç•Œé•åè‡ªå‹•ä¿®æ­£   |
| `pnpm validate:all`     | å…¨æ¤œè¨¼å®Ÿè¡Œ         |

### 7.4 ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

| ã‚³ãƒãƒ³ãƒ‰                     | èª¬æ˜                       |
| ---------------------------- | -------------------------- |
| `pnpm create:feature [name]` | ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ä½œæˆ           |
| `pnpm sc:start`              | ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹             |
| `pnpm sc:feature`            | ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ä½œæˆã‚¦ã‚£ã‚¶ãƒ¼ãƒ‰ |
| `pnpm sc:boundaries`         | å¢ƒç•Œãƒã‚§ãƒƒã‚¯               |
| `pnpm sc:validate`           | åŒ…æ‹¬çš„æ¤œè¨¼                 |

## 8. é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

### 8.1 æ–°æ©Ÿèƒ½é–‹ç™ºãƒ•ãƒ­ãƒ¼

```bash
# 1. ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹
pnpm sc:start

# 2. ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ä½œæˆ
pnpm create:feature user-profile

# 3. å®Ÿè£…ï¼ˆsrc/features/user-profile/å†…ã§ä½œæ¥­ï¼‰

# 4. å¢ƒç•Œãƒã‚§ãƒƒã‚¯
pnpm check:boundaries

# 5. ãƒ†ã‚¹ãƒˆ
pnpm test

# 6. æ¤œè¨¼
pnpm validate:all

# 7. ã‚³ãƒŸãƒƒãƒˆ
git add .
git commit -m "feat(user-profile): ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ©Ÿèƒ½ã‚’è¿½åŠ "
```

### 8.2 ãƒã‚°ä¿®æ­£ãƒ•ãƒ­ãƒ¼

```bash
# 1. å›å¸°ãƒ†ã‚¹ãƒˆä½œæˆï¼ˆå¿…é ˆï¼‰
# tests/regression/YYYY-MM-DD-NNN-description.test.ts

# 2. ãƒ†ã‚¹ãƒˆå¤±æ•—ç¢ºèª
pnpm test:regression

# 3. ä¿®æ­£å®Ÿè£…

# 4. ãƒ†ã‚¹ãƒˆæˆåŠŸç¢ºèª
pnpm test:regression

# 5. å…¨ä½“æ¤œè¨¼
pnpm validate:all
```

## 9. Git Hooks

### 9.1 pre-commit

- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«æ•´åˆæ€§ãƒã‚§ãƒƒã‚¯
- å˜ä¸€ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒã‚§ãƒƒã‚¯ï¼ˆè¤‡æ•°ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼åŒæ™‚ã‚³ãƒŸãƒƒãƒˆé˜²æ­¢ï¼‰
- å¢ƒç•Œé•åãƒã‚§ãƒƒã‚¯
- ESLint + TypeScript ãƒã‚§ãƒƒã‚¯
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

### 9.2 commit-msg

- ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å½¢å¼æ¤œè¨¼
- å½¢å¼: `type(scope): description`
- è¨±å¯ã•ã‚Œã‚‹type: feat, fix, docs, style, refactor, test, chore

## 10. Claude Codeé€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

### 10.1 æ¦‚è¦

Claude CodeãŒã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ã¾ãŸã¯æ‰¿èªå¾…ã¡æ™‚ã«ã€Slack/macOSé€šçŸ¥ã‚’é€ä¿¡ã™ã‚‹ã‚·ã‚¹ãƒ†ãƒ ã€‚

### 10.2 ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Claude Code                                                  â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ Hooks System                                             â”‚ â”‚
â”‚ â”‚ â”œâ”€ Stop Event      â†’ ã‚¿ã‚¹ã‚¯å®Œäº†æ™‚ã«ç™ºç«                  â”‚ â”‚
â”‚ â”‚ â””â”€ Notification Event â†’ æ‰¿èªå¾…ã¡/60ç§’ã‚¢ã‚¤ãƒ‰ãƒ«æ™‚ã«ç™ºç«   â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                              â”‚                               â”‚
â”‚                              â–¼                               â”‚
â”‚ ~/.claude/slack-notify.sh (é€šçŸ¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆ)                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â–¼                    â–¼                    â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ macOS Soundâ”‚      â”‚ macOS      â”‚      â”‚ Slack      â”‚
   â”‚ (afplay)   â”‚      â”‚ Notificationâ”‚     â”‚ Webhook    â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 10.3 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«

#### 10.3.1 ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®šï¼ˆ~/.claude/settings.jsonï¼‰

```json
{
  "$schema": "https://json.schemastore.org/claude-code-settings.json",
  "hooks": {
    "Stop": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "/Users/[username]/.claude/slack-notify.sh"
          }
        ]
      }
    ],
    "Notification": [
      {
        "matcher": "permission_prompt|idle_prompt",
        "hooks": [
          {
            "type": "command",
            "command": "/Users/[username]/.claude/slack-notify.sh"
          }
        ]
      }
    ]
  }
}
```

#### 10.3.2 é€šçŸ¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆ~/.claude/slack-notify.shï¼‰

```bash
#!/bin/bash
# Claude Code Notification Script

WEBHOOK_URL="your-slack-webhook-url"  # Slack Webhook URLï¼ˆã‚ªãƒ—ã‚·ãƒ§ãƒ³ï¼‰

# ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆåã‚’å–å¾—
PROJECT_NAME=$(basename "$(pwd)")

# ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä½œæˆ
MESSAGE="Claude Code is waiting in *${PROJECT_NAME}*"

# 1. ã‚µã‚¦ãƒ³ãƒ‰å†ç”Ÿï¼ˆmacOSï¼‰
if [[ "$OSTYPE" == "darwin"* ]]; then
  afplay /System/Library/Sounds/Glass.aiff &
fi

# 2. macOSé€šçŸ¥
if [[ "$OSTYPE" == "darwin"* ]]; then
  osascript -e "display notification \"$MESSAGE\" with title \"Claude Code\" sound name \"Glass\""
fi

# 3. Slacké€šçŸ¥ï¼ˆè¨­å®šæ™‚ã®ã¿ï¼‰
if [ -n "$WEBHOOK_URL" ]; then
  curl -s -X POST "$WEBHOOK_URL" \
    -H "Content-Type: application/json" \
    -d "{\"text\": \"$MESSAGE\"}" > /dev/null 2>&1
fi
```

### 10.4 Hooks ã‚¤ãƒ™ãƒ³ãƒˆä»•æ§˜

| ã‚¤ãƒ™ãƒ³ãƒˆ         | ãƒãƒƒãƒãƒ£ãƒ¼               | ç™ºç«ã‚¿ã‚¤ãƒŸãƒ³ã‚°               |
| ---------------- | ------------------------ | ---------------------------- |
| **Stop**         | `""` (ç©ºæ–‡å­— = å…¨ãƒãƒƒãƒ) | Claude Codeã‚¿ã‚¹ã‚¯å®Œäº†æ™‚      |
| **Notification** | `permission_prompt`      | æ‰¿èªå¾…ã¡ï¼ˆãƒ„ãƒ¼ãƒ«ä½¿ç”¨è¨±å¯ç­‰ï¼‰ |
| **Notification** | `idle_prompt`            | 60ç§’é–“ã‚¢ã‚¤ãƒ‰ãƒ«çŠ¶æ…‹ç¶™ç¶šæ™‚     |

### 10.5 ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ–¹æ³•

#### è‡ªå‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ï¼ˆæ¨å¥¨ï¼‰

```bash
# ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚¯ãƒ­ãƒ¼ãƒ³å¾Œã«å®Ÿè¡Œ
pnpm setup:sc

# å¯¾è©±ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ:
# 1. ã€Œé€šçŸ¥ã‚’è¨­å®šã—ã¾ã™ã‹ï¼Ÿ (y/N):ã€â†’ y
# 2. ã€ŒWebhook URL:ã€â†’ Slack Webhook URLã‚’å…¥åŠ›ï¼ˆç©ºæ¬„å¯ï¼‰
```

#### æ‰‹å‹•ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```bash
# 1. é€šçŸ¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ
mkdir -p ~/.claude
cat > ~/.claude/slack-notify.sh << 'EOF'
#!/bin/bash
PROJECT_NAME=$(basename "$(pwd)")
MESSAGE="Claude Code is waiting in *${PROJECT_NAME}*"
afplay /System/Library/Sounds/Glass.aiff &
osascript -e "display notification \"$MESSAGE\" with title \"Claude Code\" sound name \"Glass\""
EOF
chmod +x ~/.claude/slack-notify.sh

# 2. settings.jsonã«hooksè¿½åŠ ï¼ˆæ‰‹å‹•ç·¨é›†ï¼‰
```

### 10.6 Slack Webhookè¨­å®šæ‰‹é †

1. https://api.slack.com/apps ã«ã‚¢ã‚¯ã‚»ã‚¹
2. ã€ŒCreate New Appã€â†’ã€ŒFrom scratchã€
3. ã‚¢ãƒ—ãƒªåã¨ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã‚’é¸æŠ
4. å·¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã€ŒIncoming Webhooksã€ã‚’ã‚¯ãƒªãƒƒã‚¯
5. ã€ŒActivate Incoming Webhooksã€ã‚’ON
6. ã€ŒAdd New Webhook to Workspaceã€ã‚’ã‚¯ãƒªãƒƒã‚¯
7. é€šçŸ¥å…ˆãƒãƒ£ãƒ³ãƒãƒ«ã‚’é¸æŠ
8. ç”Ÿæˆã•ã‚ŒãŸWebhook URLã‚’ã‚³ãƒ”ãƒ¼

### 10.7 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

| å•é¡Œ                      | åŸå›                                                | è§£æ±ºç­–                                   |
| ------------------------- | -------------------------------------------------- | ---------------------------------------- |
| é€šçŸ¥ãŒæ¥ãªã„              | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«settings.local.jsonãŒã‚ã‚ŠhooksãŒãªã„ | ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆè¨­å®šã«ã‚‚hooksã‚’è¿½åŠ           |
| Slackã®ã¿æ¥ãªã„           | Webhook URLãŒæœªè¨­å®šã¾ãŸã¯ç„¡åŠ¹                      | URLã‚’ç¢ºèªã—ã¦å†è¨­å®š                      |
| éŸ³ãŒé³´ã‚‰ãªã„              | macOSä»¥å¤–ã®OS                                      | Linuxã®å ´åˆã¯`paplay`ç­‰ã«å¤‰æ›´            |
| Cursor/VSCodeã§å‹•ä½œã—ãªã„ | æ—¢çŸ¥ã®ãƒã‚°ï¼ˆIssue #11156ï¼‰                         | Stopãƒ•ãƒƒã‚¯ã¯å‹•ä½œã€Notificationã¯ä¿®æ­£å¾…ã¡ |

### 10.8 ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰è¨­å®š

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«`.claude/settings.local.json`ãŒã‚ã‚‹å ´åˆã€hooksã‚’å«ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ï¼š

```json
{
  "hooks": {
    "Stop": [
      {
        "matcher": "",
        "hooks": [
          {
            "type": "command",
            "command": "/Users/[username]/.claude/slack-notify.sh"
          }
        ]
      }
    ],
    "Notification": [
      {
        "matcher": "permission_prompt|idle_prompt",
        "hooks": [
          {
            "type": "command",
            "command": "/Users/[username]/.claude/slack-notify.sh"
          }
        ]
      }
    ]
  },
  "permissions": {
    // æ—¢å­˜ã®æ¨©é™è¨­å®š
  }
}
```

## 11. å‰ææ¡ä»¶

### 11.1 å¿…é ˆ

- Node.js >= 20.19.0
- pnpm >= 8.0.0
- Git

### 10.2 æ¨å¥¨ï¼ˆãƒ•ãƒ«æ©Ÿèƒ½ä½¿ç”¨æ™‚ï¼‰

- Claude Code CLI
- SuperClaude v4.0.8
- MCPã‚µãƒ¼ãƒãƒ¼
  - Serenaï¼ˆã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ï¼‰
  - Context7ï¼ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‚ç…§ï¼‰
  - Sequential-thinkingï¼ˆæ§‹é€ åŒ–åˆ†æï¼‰
  - Morphllmï¼ˆé«˜é€Ÿç·¨é›†ï¼‰
  - Playwrightï¼ˆE2Eãƒ†ã‚¹ãƒˆï¼‰

## 12. ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—æ‰‹é †

```bash
# 1. ãƒªãƒã‚¸ãƒˆãƒªã‚¯ãƒ­ãƒ¼ãƒ³
git clone [repository-url] my-app
cd my-app

# 2. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
pnpm install

# 3. ç’°å¢ƒå¤‰æ•°è¨­å®š
cp .env.example .env.local
# .env.localã‚’ç·¨é›†

# 4. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
pnpm dev

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ http://localhost:3000 ã‚’é–‹ã
```

## 13. ãƒ‡ãƒ—ãƒ­ã‚¤

### 13.1 Vercelï¼ˆæ¨å¥¨ï¼‰

```bash
# Vercel CLIã§ãƒ‡ãƒ—ãƒ­ã‚¤
vercel

# ã¾ãŸã¯ GitHubé€£æºã§è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤
```

### 13.2 ãƒ“ãƒ«ãƒ‰è¨­å®š

| è¨­å®š             | å€¤             |
| ---------------- | -------------- |
| Build Command    | `pnpm build`   |
| Output Directory | `.next`        |
| Install Command  | `pnpm install` |
| Node.js Version  | 20.x           |

## 14. ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æŒ‡æ¨™

| æŒ‡æ¨™          | ç›®æ¨™å€¤  | ç¾åœ¨å€¤  |
| ------------- | ------- | ------- |
| First Load JS | < 150KB | 102KB   |
| ãƒ“ãƒ«ãƒ‰æ™‚é–“    | < 5ç§’   | ~2ç§’    |
| å¢ƒç•Œãƒã‚§ãƒƒã‚¯  | < 500ms | < 100ms |
| ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ    | < 10ç§’  | ~1ç§’    |

## 15. å“è³ªåŸºæº–

### 15.1 TypeScriptå“è³ªï¼ˆ97%ãƒ¢ãƒ¼ãƒ‰ï¼‰

- `strict: true`
- `noImplicitAny: true`
- `strictNullChecks: true`
- `noUnusedLocals: true`
- `noUnusedParameters: true`

### 15.2 ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸

- ã‚°ãƒ­ãƒ¼ãƒãƒ«: 90%ä»¥ä¸Š
- ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼å˜ä½: 95%ä»¥ä¸Š

### 15.3 ã‚³ãƒ¼ãƒ‰å“è³ª

- ESLint 9 flat config
- Prettierçµ±åˆ
- å¢ƒç•Œé•åã‚¼ãƒ­ãƒˆãƒ¬ãƒ©ãƒ³ã‚¹

## 16. Hi & Low ã‚²ãƒ¼ãƒ æ©Ÿèƒ½ä»•æ§˜

### 16.1 ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼æ§‹é€ 

```
src/features/game/
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ Card.tsx           # ãƒˆãƒ©ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰è¡¨ç¤º
â”‚   â”œâ”€â”€ GameBoard.tsx      # ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰ï¼ˆãƒ¡ã‚¤ãƒ³UIï¼‰
â”‚   â””â”€â”€ Ranking.tsx        # ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º
â”œâ”€â”€ constants/
â”‚   â””â”€â”€ index.ts           # å®šæ•°å®šç¾©
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useGame.ts         # ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯
â”‚   â””â”€â”€ useSecretGesture.ts # ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts           # å‹å®šç¾©
â””â”€â”€ index.ts               # å…¬é–‹API
```

**å…¬é–‹APIï¼ˆsrc/features/game/index.tsï¼‰:**

```typescript
'use client'

// ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆå…¬é–‹ï¼‰- ãƒšãƒ¼ã‚¸ã‹ã‚‰ä½¿ç”¨ã™ã‚‹ãŸã‚å¿…è¦
export { GameBoard } from './components/GameBoard'

// å‹å®šç¾©ï¼ˆå¿…è¦ãªå‹ã®ã¿å…¬é–‹ï¼‰
export type { RankingEntry } from './types'
```

- `'use client'` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒ†ã‚£ãƒ–å¿…é ˆï¼ˆGameBoardãŒã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãŸã‚ï¼‰
- GameBoardã®ã¿named exportï¼ˆä»–ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ»ãƒ•ãƒƒã‚¯ãƒ»å®šæ•°ã¯éå…¬é–‹ï¼‰
- RankingEntryå‹ã®ã¿å‹ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆï¼ˆãƒ†ã‚¹ãƒˆç”¨é€”ï¼‰

### 16.2 å‹å®šç¾©ï¼ˆsrc/features/game/types/index.tsï¼‰

```typescript
// ã‚¹ãƒ¼ãƒˆï¼ˆãƒãƒ¼ã‚¯ï¼‰
type Suit = 'hearts' | 'diamonds' | 'clubs' | 'spades'

// ã‚«ãƒ¼ãƒ‰å€¤ï¼ˆ1-13: A-Kï¼‰
type CardValue = 1 | 2 | 3 | 4 | 5 | 6 | 7 | 8 | 9 | 10 | 11 | 12 | 13

// ã‚«ãƒ¼ãƒ‰
interface Card {
  readonly suit: Suit
  readonly value: CardValue
}

// ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®äºˆæƒ³
type Guess = 'high' | 'low'

// ã‚²ãƒ¼ãƒ çŠ¶æ…‹
type GameState = 'playing' | 'won' | 'lost' | 'draw' | 'gameover'

// ã‚²ãƒ¼ãƒ çµæœï¼ˆå°†æ¥ã®APIæ‹¡å¼µç”¨ã€‚v1.0.0ã§ã¯æœªä½¿ç”¨ï¼‰
interface GameResult {
  readonly state: GameState
  readonly currentCard: Card
  readonly nextCard: Card | null
  readonly streak: number
  readonly highScore: number
}

// ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¨ãƒ³ãƒˆãƒª
interface RankingEntry {
  readonly rank: number
  readonly name: string
  readonly score: number
}
```

### 16.3 å®šæ•°å®šç¾©ï¼ˆsrc/features/game/constants/index.tsï¼‰

```typescript
// ã‚¹ãƒ¼ãƒˆä¸€è¦§
const SUITS: readonly Suit[] = ['hearts', 'diamonds', 'clubs', 'spades']

// ã‚¹ãƒ¼ãƒˆçµµæ–‡å­—
const SUIT_EMOJI: Record<Suit, string> = {
  hearts: 'â™¥',
  diamonds: 'â™¦',
  clubs: 'â™£',
  spades: 'â™ ',
}

// ã‚¹ãƒ¼ãƒˆè‰²ï¼ˆTailwind CSSï¼‰
const SUIT_COLOR: Record<Suit, string> = {
  hearts: 'text-red-500',
  diamonds: 'text-red-500',
  clubs: 'text-gray-900',
  spades: 'text-gray-900',
}

// ã‚«ãƒ¼ãƒ‰å€¤è¡¨ç¤º
const VALUE_DISPLAY: Record<CardValue, string> = {
  1: 'A',
  2: '2',
  3: '3',
  4: '4',
  5: '5',
  6: '6',
  7: '7',
  8: '8',
  9: '9',
  10: '10',
  11: 'J',
  12: 'Q',
  13: 'K',
}

// ãƒ©ãƒ³ã‚­ãƒ³ã‚°ãƒ‡ãƒ¼ã‚¿ï¼ˆå›ºå®šï¼‰
const RANKING_DATA: readonly RankingEntry[] = [
  { rank: 1, name: 'RIKI', score: 47 },
  { rank: 2, name: 'Boo', score: 40 },
  { rank: 3, name: 'Itusuki', score: 39 },
  { rank: 4, name: 'MAIKO', score: 33 },
  { rank: 5, name: 'DAI', score: 31 },
]

// åˆæœŸã‚³ã‚¤ãƒ³æ•°
const INITIAL_COINS = 10

// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é…å»¶ï¼ˆãƒŸãƒªç§’ï¼‰
const ANIMATION_DELAY = {
  REVEAL: 500, // ã‚«ãƒ¼ãƒ‰åˆ¤å®šã¾ã§ã®é…å»¶
  NEXT_ROUND: 1000, // æ¬¡ã®ãƒ©ã‚¦ãƒ³ãƒ‰ã¸ã®é·ç§»
}

// ãƒ­ãƒ¼ã‚«ãƒ«ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚­ãƒ¼
const STORAGE_KEY = {
  HIGH_SCORE: 'hi-and-low-high-score',
  COINS: 'hi-and-low-coins',
}

// ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥è¨­å®š
const TOAST_CONFIG = {
  ENTER_DELAY: 50, // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³é–‹å§‹ã¾ã§ã®é…å»¶ï¼ˆmsï¼‰
  DISPLAY_DURATION: 3000, // è¡¨ç¤ºæ™‚é–“ï¼ˆmsï¼‰
  HIDE_DELAY: 3500, // éè¡¨ç¤ºã¾ã§ã®ç·æ™‚é–“ï¼ˆmsï¼‰
}
```

### 16.4 ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆsrc/features/game/hooks/useGame.tsï¼‰

#### çŠ¶æ…‹ç®¡ç†

| çŠ¶æ…‹          | å‹           | åˆæœŸå€¤           | èª¬æ˜                   |
| ------------- | ------------ | ---------------- | ---------------------- |
| currentCard   | Card \| null | nullï¼ˆå¾Œã§è¨­å®šï¼‰ | ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰           |
| nextCard      | Card \| null | null             | æ¬¡ã®ã‚«ãƒ¼ãƒ‰             |
| gameState     | GameState    | 'playing'        | ã‚²ãƒ¼ãƒ çŠ¶æ…‹             |
| streak        | number       | 0                | é€£å‹æ•°                 |
| highScore     | number       | localStorage     | ãƒã‚¤ã‚¹ã‚³ã‚¢             |
| coins         | number       | localStorage/10  | æ‰€æŒã‚³ã‚¤ãƒ³             |
| isRevealing   | boolean      | false            | ã‚«ãƒ¼ãƒ‰åˆ¤å®šä¸­ãƒ•ãƒ©ã‚°     |
| isInitialized | boolean      | false            | ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–æ¸ˆã¿ |

#### ä¸»è¦é–¢æ•°

**makeGuess(guess: Guess): void**

- ã‚¬ãƒ¼ãƒ‰æ¡ä»¶: currentCard===null, gameState!=='playing', isRevealing, coins<=0
- 1ã‚³ã‚¤ãƒ³æ¶ˆè²»
- æ–°ã—ã„ã‚«ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¦nextCardã«è¨­å®š
- isRevealingã‚’trueã«è¨­å®š
- ANIMATION_DELAY.REVEALï¼ˆ500msï¼‰å¾Œã«åˆ¤å®šå®Ÿè¡Œ:

```typescript
const isDraw = newCard.value === currentCard.value
const isWin =
  (guess === 'high' && newCard.value > currentCard.value) ||
  (guess === 'low' && newCard.value < currentCard.value)
```

**åˆ¤å®šçµæœã¨å‡¦ç†:**

| çµæœ           | æ¡ä»¶                  | ã‚³ã‚¤ãƒ³å¤‰å‹•    | gameState  | é€£å‹        | æ¬¡ãƒ©ã‚¦ãƒ³ãƒ‰         |
| -------------- | --------------------- | ------------- | ---------- | ----------- | ------------------ |
| ãƒ‰ãƒ­ãƒ¼         | åŒã˜å€¤                | +1ï¼ˆè¿”å´ï¼‰    | 'draw'     | ç¶­æŒ        | 1000mså¾Œã«è‡ªå‹•é·ç§» |
| å‹åˆ©           | äºˆæƒ³ã¨ä¸€è‡´            | +streak+1     | 'won'      | +1          | 1000mså¾Œã«è‡ªå‹•é·ç§» |
| æ•—åŒ—           | äºˆæƒ³ã¨ä¸ä¸€è‡´ã€coins>0 | 0ï¼ˆæ¶ˆè²»æ¸ˆã¿ï¼‰ | 'lost'     | 0ã«ãƒªã‚»ãƒƒãƒˆ | ãƒœã‚¿ãƒ³ã§æ‰‹å‹•é·ç§»   |
| ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ | äºˆæƒ³ã¨ä¸ä¸€è‡´ã€coins=0 | 0             | 'gameover' | 0ã«ãƒªã‚»ãƒƒãƒˆ | fullResetã§å†é–‹    |

**resetGame(): void**

- clearAllTimers â†’ generateRandomCard â†’ çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆï¼ˆã‚³ã‚¤ãƒ³ã¯ç¶­æŒï¼‰

**fullReset(): void**

- resetGameã¨åŒã˜ + ã‚³ã‚¤ãƒ³ã‚’INITIAL_COINS(10)ã«ãƒªã‚»ãƒƒãƒˆ + localStorageæ›´æ–°

#### SSRå¯¾å¿œï¼ˆHydration Mismatché˜²æ­¢ï¼‰

```typescript
// ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆå´ã§ã®ã¿ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ
useEffect(() => {
  setCurrentCard(generateRandomCard())
  setHighScore(safeStorage.get(STORAGE_KEY.HIGH_SCORE, 0))
  setCoins(safeStorage.get(STORAGE_KEY.COINS, INITIAL_COINS))
  setIsInitialized(true)
}, [])
```

#### å®‰å…¨ãªlocalStorageæ“ä½œ

```typescript
const safeStorage = {
  get<T>(key: string, defaultValue: T): T {
    if (typeof window === 'undefined') return defaultValue
    try {
      const stored = localStorage.getItem(key)
      if (stored === null) return defaultValue
      const parsed = JSON.parse(stored) as unknown
      // å‹ãƒã‚§ãƒƒã‚¯: ãƒ‘ãƒ¼ã‚¹çµæœãŒãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã¨åŒã˜å‹ã®å ´åˆã®ã¿è¿”ã™
      return typeof parsed === typeof defaultValue ? (parsed as T) : defaultValue
    } catch {
      // localStorageç„¡åŠ¹æ™‚ã‚„ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’è¿”ã™
      return defaultValue
    }
  },
  set<T>(key: string, value: T): void {
    if (typeof window === 'undefined') return
    try {
      localStorage.setItem(key, JSON.stringify(value))
    } catch {
      // Quotaè¶…éæ™‚ç­‰ã¯é™ã‹ã«å¤±æ•—ï¼ˆã‚²ãƒ¼ãƒ ã®ç¶šè¡Œã‚’å„ªå…ˆï¼‰
    }
  },
}
```

#### ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢

```typescript
// ã‚¿ã‚¤ãƒãƒ¼Refç®¡ç†
const revealTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null)
const transitionTimerRef = useRef<ReturnType<typeof setTimeout> | null>(null)
const isMountedRef = useRef(true)

// ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
useEffect(() => {
  isMountedRef.current = true
  return () => {
    isMountedRef.current = false
    clearAllTimers()
  }
}, [])
```

#### æˆ»ã‚Šå€¤ï¼ˆuseMemoã§ãƒ¡ãƒ¢åŒ–ï¼‰

```typescript
return useMemo(
  () => ({
    currentCard, // Card | null - ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰
    nextCard, // Card | null - æ¬¡ã®ã‚«ãƒ¼ãƒ‰
    gameState, // GameState - ã‚²ãƒ¼ãƒ çŠ¶æ…‹
    streak, // number - é€£å‹æ•°
    highScore, // number - ãƒã‚¤ã‚¹ã‚³ã‚¢
    coins, // number - æ‰€æŒã‚³ã‚¤ãƒ³
    isRevealing, // boolean - ã‚«ãƒ¼ãƒ‰åˆ¤å®šä¸­ãƒ•ãƒ©ã‚°
    isInitialized, // boolean - ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆåˆæœŸåŒ–æ¸ˆã¿
    makeGuess, // (guess: Guess) => void - äºˆæƒ³ã‚’è¡Œã†
    resetGame, // () => void - æ•—åŒ—å¾Œã«ç¶šã‘ã‚‹
    fullReset, // () => void - ã‚³ã‚¤ãƒ³ã‚‚åˆæœŸåŒ–ã—ã¦ãƒªã‚»ãƒƒãƒˆ
  }),
  [
    /* å…¨ä¾å­˜é…åˆ— */
  ]
)
```

#### ãƒ©ãƒ³ãƒ€ãƒ ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ

```typescript
function generateRandomCard(): Card {
  // Math.random()ã‚’ä½¿ç”¨ï¼ˆã‚²ãƒ¼ãƒ ç”¨é€”ã®ãŸã‚æš—å·å­¦çš„å®‰å…¨æ€§ä¸è¦ï¼‰
  // eslint-disable-next-line sonarjs/pseudo-random
  const suit = SUITS[Math.floor(Math.random() * SUITS.length)] as Suit
  const value = (Math.floor(Math.random() * 13) + 1) as CardValue
  return { suit, value }
}
```

#### å†…éƒ¨ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°

| é–¢æ•°å                | å¼•æ•° | èª¬æ˜                                     |
| --------------------- | ---- | ---------------------------------------- |
| generateRandomCard    | ãªã— | ãƒ©ãƒ³ãƒ€ãƒ ãªCardã‚’ç”Ÿæˆ                     |
| clearAllTimers        | ãªã— | revealTimer/transitionTimerã‚’å…¨ã‚¯ãƒªã‚¢    |
| transitionToNextRound | Card | 1000mså¾Œã«æ¬¡ãƒ©ã‚¦ãƒ³ãƒ‰ã¸é·ç§»               |
| initializeGameState   | ãªã— | ã‚¿ã‚¤ãƒãƒ¼ã‚¯ãƒªã‚¢+æ–°ã‚«ãƒ¼ãƒ‰ç”Ÿæˆ+çŠ¶æ…‹ãƒªã‚»ãƒƒãƒˆ |

### 16.5 ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆä»•æ§˜

#### Card.tsx - ãƒˆãƒ©ãƒ³ãƒ—ã‚«ãƒ¼ãƒ‰

**Props:**

```typescript
interface CardProps {
  readonly card: Card | null
  readonly isHidden?: boolean // è£é¢è¡¨ç¤º
  readonly className?: string
}
```

**ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°:**

- è£é¢ï¼ˆ`isHidden=true` ã¾ãŸã¯ `card=null`ï¼‰: é’ã„ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ï¼ˆfrom-blue-600 to-blue-800ï¼‰ + ğŸƒçµµæ–‡å­—
- è¡¨é¢: ç™½èƒŒæ™¯ã€3ã¤ã®ã‚¨ãƒªã‚¢ã«åˆ†å‰²:
  - å·¦ä¸Š: å€¤ï¼ˆA-Kï¼‰ + ã‚¹ãƒ¼ãƒˆçµµæ–‡å­—ï¼ˆç¸¦ä¸¦ã³ï¼‰
  - ä¸­å¤®: ã‚¹ãƒ¼ãƒˆçµµæ–‡å­—ï¼ˆå¤§ãã‚ text-3xlï¼‰
  - å³ä¸‹: å€¤ + ã‚¹ãƒ¼ãƒˆçµµæ–‡å­—ï¼ˆ`rotate-180`ã§é€†ã•ã¾è¡¨ç¤ºï¼‰
- ã‚µã‚¤ã‚º: w-24 h-36ï¼ˆ96px x 144pxï¼‰
- ã‚¹ã‚¿ã‚¤ãƒ«: rounded-lg, border-2 border-gray-300, shadow-lg

**ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆGameBoardå†…ï¼‰:**

```typescript
<Card card={currentCard} isHidden={currentCard === null} />
<span>â†’</span>
<Card card={nextCard} isHidden={!isRevealing && nextCard === null} />
```

- å·¦ã‚«ãƒ¼ãƒ‰: ç¾åœ¨ã®ã‚«ãƒ¼ãƒ‰ï¼ˆå¸¸ã«è¡¨ï¼‰
- å³ã‚«ãƒ¼ãƒ‰: isRevealingæ™‚ã®ã¿è¡¨ç¤ºã€ãã‚Œä»¥å¤–ã¯è£é¢

#### GameBoard.tsx - ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰

**æ§‹æˆï¼ˆä¸Šã‹ã‚‰é †ã«ï¼‰:**

1. **ãƒ˜ãƒƒãƒ€ãƒ¼** - ğŸƒã‚¢ã‚¤ã‚³ãƒ³ï¼ˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼å¯¾è±¡ï¼‰+ "Hi & Low" ãƒ†ã‚­ã‚¹ãƒˆ
2. **ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥** - åˆå›ã‚¢ã‚¯ã‚»ã‚¹æ™‚ã€å³ã‹ã‚‰ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³ï¼ˆfixed overlayï¼‰
3. **ã‚¹ã‚³ã‚¢è¡¨ç¤º** - 3ã¤ã®ã‚¹ã‚³ã‚¢ã‚’æ¨ªä¸¦ã³ï¼ˆgap-6ï¼‰
   - ã‚³ã‚¤ãƒ³: ğŸª™ {coins}ï¼ˆtext-yellow-300ï¼‰
   - é€£å‹: {streak}ï¼ˆtext-whiteï¼‰
   - ãƒã‚¤ã‚¹ã‚³ã‚¢: {highScore}ï¼ˆtext-yellow-400ï¼‰
4. **ã‚«ãƒ¼ãƒ‰è¡¨ç¤ºã‚¨ãƒªã‚¢** - 2æšã®ã‚«ãƒ¼ãƒ‰ + çŸ¢å°ï¼ˆâ†’ï¼‰
5. **æ“ä½œãƒœã‚¿ãƒ³ã‚¨ãƒªã‚¢** - min-h-[72px] ã§é«˜ã•å›ºå®šï¼ˆçŠ¶æ…‹é·ç§»æ™‚ã®ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã‚¸ãƒ£ãƒ³ãƒ—é˜²æ­¢ï¼‰
6. **ãƒ©ãƒ³ã‚­ãƒ³ã‚°** - max-w-sm ã§ä¸­å¤®é…ç½®

**SSR/ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°çŠ¶æ…‹:**

`isInitialized === false` ã®é–“ã¯å°‚ç”¨ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ç”»é¢ã‚’è¡¨ç¤ºï¼ˆHydration mismatchå›é¿ï¼‰:

```typescript
if (!isInitialized) {
  return (
    <div className="flex min-h-screen flex-col items-center justify-center
                    bg-gradient-to-b from-green-800 to-green-900">
      <span className="text-4xl">ğŸƒ</span>
      <p className="mt-4 text-xl text-white">Loading...</p>
    </div>
  )
}
```

**ãƒˆãƒ¼ã‚¹ãƒˆé€šçŸ¥ä»•æ§˜:**

```typescript
// çŠ¶æ…‹: 'hidden' | 'entering' | 'visible' | 'exiting'
// TOAST_CONFIG.ENTER_DELAY(50ms)å¾Œã« 'visible' ã¸é·ç§»
// TOAST_CONFIG.DISPLAY_DURATION(3000ms)å¾Œã« 'exiting' ã¸é·ç§»
// TOAST_CONFIG.HIDE_DELAY(3500ms)å¾Œã« 'hidden' ã¸é·ç§»
// ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³: translateX ã§å³ç«¯ã‹ã‚‰ã‚¹ãƒ©ã‚¤ãƒ‰ã‚¤ãƒ³/ã‚¢ã‚¦ãƒˆï¼ˆ500ms ease-outï¼‰
// ä½ç½®: fixed right-4 top-4 z-50
// ã‚¹ã‚¿ã‚¤ãƒ«: bg-yellow-500, font-bold, text-white, rounded-lg, shadow-lg
// ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: "é€šçŸ¥ï¼šğŸ”¥ ãã‚‡ã†ã‚‚ãƒã‚¤ã‚¹ã‚³ã‚¢ã‚’æ›´æ–°ã—ã‚ˆã†ï¼"
// ãƒˆãƒªã‚¬ãƒ¼: isInitialized ãŒ true ã«ãªã£ãŸæ™‚ï¼ˆuseEffectï¼‰
```

**ãƒœã‚¿ãƒ³çŠ¶æ…‹ï¼ˆGameButtonså†…éƒ¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼‰:**

GameBoardå†…éƒ¨ã«å®šç¾©ã•ã‚ŒãŸ`GameButtons`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãŒçŠ¶æ…‹ã«å¿œã˜ãŸUIã‚’æç”»ã™ã‚‹ã€‚

```typescript
function GameButtons({
  gameState, isRevealing, coins, streak,
  onHigh, onLow, onReset, onFullReset,
}: { ... }): React.JSX.Element
```

| gameState | æ¡ä»¶                      | è¡¨ç¤ºå†…å®¹                                          | ã‚¹ã‚¿ã‚¤ãƒ«                          |
| --------- | ------------------------- | ------------------------------------------------- | --------------------------------- |
| gameover  | -                         | "ğŸ’€ ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼" + "ğŸ”„ æœ€åˆã‹ã‚‰ã‚„ã‚Šç›´ã™"ãƒœã‚¿ãƒ³ | bg-purple-500                     |
| playing   | !isRevealing && coins > 0 | "â¬†ï¸ HIGH" / "â¬‡ï¸ LOW" ãƒœã‚¿ãƒ³                       | bg-red-500 / bg-blue-500          |
| won       | -                         | "ğŸ‰ æ­£è§£ï¼ +{streak}ã‚³ã‚¤ãƒ³"                       | bg-yellow-500/20, text-yellow-400 |
| draw      | -                         | "ğŸ¤ ãƒ‰ãƒ­ãƒ¼ï¼ã‚³ã‚¤ãƒ³è¿”å´"                           | bg-blue-500/20, text-blue-300     |
| lost      | -                         | "ğŸ’¥ ç¶šã‘ã‚‹"ãƒœã‚¿ãƒ³                                 | bg-yellow-500                     |
| (default) | isRevealingç­‰             | "åˆ¤å®šä¸­..."                                       | text-white                        |

**åˆ¤å®šå„ªå…ˆé †åº:** gameover â†’ playing â†’ won â†’ draw â†’ lost â†’ default

#### Ranking.tsx - ãƒ©ãƒ³ã‚­ãƒ³ã‚°è¡¨ç¤º

**Props:**

```typescript
interface RankingProps {
  readonly entries: readonly RankingEntry[]
  readonly className?: string
  readonly isSecretActivated?: boolean // å¾®å¦™ãªè‰²å¤‰åŒ–
}
```

**ãƒ©ãƒ³ã‚¯ã‚¢ã‚¤ã‚³ãƒ³ï¼ˆgetRankIconé–¢æ•°ï¼‰:**

```typescript
function getRankIcon(rank: number): string {
  if (rank <= 0) return '-'
  if (rank === 1) return 'ğŸ¥‡'
  if (rank === 2) return 'ğŸ¥ˆ'
  if (rank === 3) return 'ğŸ¥‰'
  return String(rank)
}
```

**ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆ:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ† ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆtext-lg, text-gray-800ï¼‰â”‚
â”‚                                     â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ ğŸ¥‡ RIKI                     47 â”‚ â”‚  â† bg-white, rounded-md, shadow-sm
â”‚ â”‚ ğŸ¥ˆ Boo                      40 â”‚ â”‚     åå‰: text-gray-700
â”‚ â”‚ ğŸ¥‰ Itusuki                  39 â”‚ â”‚     ã‚¹ã‚³ã‚¢: text-blue-600, font-bold
â”‚ â”‚  4 MAIKO                    33 â”‚ â”‚
â”‚ â”‚  5 DAI                      31 â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
èƒŒæ™¯: bg-gray-100ï¼ˆé€šå¸¸ï¼‰/ bg-blue-100ï¼ˆã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆæ´»æ€§åŒ–æ™‚ï¼‰
é·ç§»: transition-colors duration-300
```

### 16.6 UI/UXãƒ‡ã‚¶ã‚¤ãƒ³

#### ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ

| è¦ç´              | è‰²                                   |
| ---------------- | ------------------------------------ |
| èƒŒæ™¯             | green-800 â†’ green-900 ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ |
| ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ†ã‚­ã‚¹ãƒˆ | white                                |
| ã‚³ã‚¤ãƒ³           | yellow-300                           |
| ãƒã‚¤ã‚¹ã‚³ã‚¢       | yellow-400                           |
| é€£å‹             | white                                |
| HIGHãƒœã‚¿ãƒ³       | red-500                              |
| LOWãƒœã‚¿ãƒ³        | blue-500                             |
| ç¶šã‘ã‚‹ãƒœã‚¿ãƒ³     | yellow-500                           |
| ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³   | purple-500                           |
| ãƒˆãƒ¼ã‚¹ãƒˆ         | yellow-500                           |
| ãƒ©ãƒ³ã‚­ãƒ³ã‚°èƒŒæ™¯   | gray-100/gray-50                     |

#### ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³

| è¦ç´            | ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³                        |
| -------------- | ------------------------------------- |
| ãƒœã‚¿ãƒ³ãƒ›ãƒãƒ¼   | scale-95 + shadow-xl                  |
| ãƒˆãƒ¼ã‚¹ãƒˆ       | translateX ã‚¹ãƒ©ã‚¤ãƒ‰ï¼ˆ500ms ease-outï¼‰ |
| çŠ¶æ…‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ | èƒŒæ™¯è‰² + é€æ˜åº¦å¤‰åŒ–                   |

### 16.7 ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ–

**localStorage ã‚­ãƒ¼:**

- `hi-and-low-high-score`: ãƒã‚¤ã‚¹ã‚³ã‚¢ï¼ˆnumberï¼‰
- `hi-and-low-coins`: æ‰€æŒã‚³ã‚¤ãƒ³ï¼ˆnumberï¼‰

**åˆæœŸåŒ–:**

- ãƒã‚¤ã‚¹ã‚³ã‚¢: 0
- ã‚³ã‚¤ãƒ³: 10

### 16.8 ãƒšãƒ¼ã‚¸æ§‹æˆï¼ˆsrc/app/page.tsxï¼‰

```typescript
export default function Home(): React.JSX.Element {
  return (
    <FeatureErrorBoundary featureName="game">
      <GameBoard />
    </FeatureErrorBoundary>
  )
}
```

### 16.9 å›å¸°ãƒ†ã‚¹ãƒˆ

| ID             | ãƒ•ã‚¡ã‚¤ãƒ«                   | ãƒ†ã‚¹ãƒˆå†…å®¹                                              |
| -------------- | -------------------------- | ------------------------------------------------------- |
| 2025-02-04-001 | game-edge-cases.test.ts    | localStorage ã‚¨ãƒ©ãƒ¼ã€ã‚³ã‚¤ãƒ³è¨ˆç®—ã€ãƒ©ãƒ³ã‚­ãƒ³ã‚°ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ |
| 2025-02-04-002 | hydration-mismatch.test.ts | SSR/Hydrationå¯¾ç­–ãƒ‘ã‚¿ãƒ¼ãƒ³                               |
| 2025-02-04-003 | timer-cleanup.test.ts      | ã‚¿ã‚¤ãƒãƒ¼ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã€isMountedRef                    |
| 2025-02-06-001 | secret-gesture.test.ts     | ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã®ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†ãƒ»çŠ¶æ…‹è¿½è·¡        |

## 17. ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼æ©Ÿèƒ½ä»•æ§˜

### 17.1 æ¦‚è¦

ãƒ˜ãƒƒãƒ€ãƒ¼ã®ğŸƒã‚¢ã‚¤ã‚³ãƒ³ã«éš ã•ã‚ŒãŸã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆãƒ­ã‚°ã‚¤ãƒ³æ©Ÿèƒ½ã€‚ç‰¹å®šã®ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã‚·ãƒ¼ã‚±ãƒ³ã‚¹ã‚’å®Œäº†ã™ã‚‹ã¨ã€ãƒ¡ãƒƒã‚»ãƒ³ã‚¸ãƒ£ãƒ¼ãƒšãƒ¼ã‚¸ï¼ˆ`/m`ï¼‰ã«é·ç§»ã™ã‚‹ã€‚

**ç§˜åŒ¿æ€§è¦ä»¶:**

- ãƒã‚¤ãƒ³ã‚¿ãƒ¼ã‚¹ã‚¿ã‚¤ãƒ«å¤‰æ›´ãªã—
- é•·æŠ¼ã—ä¸­ã®è¦–è¦šå¤‰åŒ–ãªã—
- ã‚¨ãƒ©ãƒ¼æ™‚ã¯é™ã‹ã«ãƒªã‚»ãƒƒãƒˆï¼ˆãƒ¦ãƒ¼ã‚¶ãƒ¼ã¸ã®é€šçŸ¥ãªã—ï¼‰
- å”¯ä¸€ã®è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯: ãƒ©ãƒ³ã‚­ãƒ³ã‚°èƒŒæ™¯è‰²ã®å¾®å¦™ãªå¤‰åŒ–

### 17.2 ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã‚·ãƒ¼ã‚±ãƒ³ã‚¹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 1: é•·æŠ¼ã—ï¼ˆ3ç§’ï¼‰                                        â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚ ğŸƒã‚¢ã‚¤ã‚³ãƒ³ã‚’3ç§’é–“é•·æŠ¼ã—                                       â”‚
â”‚ â†’ isActivated = true                                         â”‚
â”‚ â†’ ãƒ©ãƒ³ã‚­ãƒ³ã‚°èƒŒæ™¯ãŒ bg-gray-100 â†’ bg-blue-100 ã«å¤‰åŒ–          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â†“
                    ã‚¿ãƒƒãƒ—å—ä»˜ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦é–‹å§‹ï¼ˆ2ç§’é–“ï¼‰
                              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Step 2: é€£ç¶šã‚¿ãƒƒãƒ—ï¼ˆ1ç§’ä»¥å†…ã«3å›ï¼‰                            â”‚
â”‚ â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â” â”‚
â”‚ ğŸƒã‚¢ã‚¤ã‚³ãƒ³ã‚’1ç§’ä»¥å†…ã«3å›ã‚¿ãƒƒãƒ—                                â”‚
â”‚ â†’ router.push('/m') ã§é·ç§»                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 17.3 ã‚¿ã‚¤ãƒŸãƒ³ã‚°è¨­å®šï¼ˆSECRET_CONFIGï¼‰

| è¨­å®š                | å€¤     | èª¬æ˜                          |
| ------------------- | ------ | ----------------------------- |
| LONG_PRESS_DURATION | 3000ms | é•·æŠ¼ã—åˆ¤å®šæ™‚é–“                |
| TAP_WINDOW          | 2000ms | é•·æŠ¼ã—å®Œäº†å¾Œã®ã‚¿ãƒƒãƒ—å—ä»˜æ™‚é–“  |
| TAP_TIMEOUT         | 1000ms | 3å›ã‚¿ãƒƒãƒ—ã‚’å®Œäº†ã™ã¹ãåˆ¶é™æ™‚é–“ |
| REQUIRED_TAPS       | 3      | å¿…è¦ãªã‚¿ãƒƒãƒ—å›æ•°              |
| DESTINATION         | '/m'   | é·ç§»å…ˆãƒ‘ã‚¹                    |

### 17.4 çŠ¶æ…‹é·ç§»å›³

```
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚   åˆæœŸçŠ¶æ…‹    â”‚
                    â”‚isActivated:F â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                    onPressStart()
                           â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚  é•·æŠ¼ã—ä¸­     â”‚
                    â”‚ ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚            â”‚            â”‚
         3ç§’å‰ã«é›¢ã™   3ç§’çµŒé      ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆ
              â”‚            â”‚            â”‚
              â–¼            â–¼            â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ãƒªã‚»ãƒƒãƒˆ  â”‚  â”‚æ´»æ€§åŒ–    â”‚  â”‚ã‚¯ãƒªãƒ¼ãƒ³  â”‚
        â”‚(é™ã‹ã«) â”‚  â”‚isActiv:Tâ”‚  â”‚ã‚¢ãƒƒãƒ—   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                   ã‚¿ãƒƒãƒ—å—ä»˜é–‹å§‹
                   (2ç§’ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦)
                          â”‚
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚           â”‚           â”‚
         2ç§’ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ  ã‚¿ãƒƒãƒ—æ¤œå‡º   1ç§’ä»¥å†…ã«3å›
              â”‚           â”‚           â”‚
              â–¼           â–¼           â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚ãƒªã‚»ãƒƒãƒˆ  â”‚  â”‚ã‚«ã‚¦ãƒ³ãƒˆ  â”‚  â”‚ é·ç§»    â”‚
        â”‚(é™ã‹ã«) â”‚  â”‚ +1      â”‚  â”‚ â†’ /m   â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 17.5 ãƒ•ãƒƒã‚¯å®Ÿè£…ï¼ˆuseSecretGesture.tsï¼‰

#### æˆ»ã‚Šå€¤ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

```typescript
interface SecretGestureState {
  /** ãƒ©ãƒ³ã‚­ãƒ³ã‚°è‰²å¤‰åŒ–ç”¨ãƒ•ãƒ©ã‚° */
  isActivated: boolean
  /** é•·æŠ¼ã—é–‹å§‹ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆonPointerDownç”¨ï¼‰ */
  onPressStart: () => void
  /** é•·æŠ¼ã—çµ‚äº†ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆonPointerUp/Leave/Cancelç”¨ï¼‰ */
  onPressEnd: () => void
  /** ã‚¿ãƒƒãƒ—ãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆonClickç”¨ï¼‰ */
  onTap: () => void
}
```

#### å†…éƒ¨çŠ¶æ…‹ï¼ˆRefï¼‰

| Ref                | å‹                            | ç”¨é€”                          |
| ------------------ | ----------------------------- | ----------------------------- |
| isActivatedRef     | boolean                       | ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼å•é¡Œå›é¿          |
| isMountedRef       | boolean                       | ã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆå¾Œã®stateæ›´æ–°é˜²æ­¢ |
| longPressTimerRef  | ReturnType<typeof setTimeout> | é•·æŠ¼ã—ã‚¿ã‚¤ãƒãƒ¼                |
| tapWindowTimerRef  | ReturnType<typeof setTimeout> | ã‚¿ãƒƒãƒ—å—ä»˜ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚¿ã‚¤ãƒãƒ¼  |
| tapTimeoutTimerRef | ReturnType<typeof setTimeout> | ã‚¿ãƒƒãƒ—å®Œäº†ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ        |
| tapCountRef        | number                        | ã‚¿ãƒƒãƒ—ã‚«ã‚¦ãƒ³ãƒˆ                |
| firstTapTimeRef    | number \| null                | æœ€åˆã®ã‚¿ãƒƒãƒ—æ™‚åˆ»              |
| justActivatedRef   | boolean                       | é•·æŠ¼ã—å®Œäº†ç›´å¾Œã®clickç„¡è¦–ç”¨   |

#### é‡è¦ãªå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

**1. ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼å•é¡Œã®å›é¿**

```typescript
// å•é¡Œ: setTimeoutã®ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å†…ã§stateãŒå¤ã„å€¤ã‚’å‚ç…§
// è§£æ±º: refã§æœ€æ–°å€¤ã‚’è¿½è·¡
const isActivatedRef = useRef(false)
isActivatedRef.current = isActivated

// ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯å†…ã§ã¯ isActivatedRef.current ã‚’å‚ç…§
```

**2. é•·æŠ¼ã—å®Œäº†å¾Œã®clickèª¤æ¤œçŸ¥é˜²æ­¢**

```typescript
// å•é¡Œ: é•·æŠ¼ã—å®Œäº†æ™‚ã«onPointerUpã¨onClickãŒä¸¡æ–¹ç™ºç«
// è§£æ±º: justActivatedRefãƒ•ãƒ©ã‚°ã§æœ€åˆã®clickã‚’ç„¡è¦–
const justActivatedRef = useRef(false)

// é•·æŠ¼ã—å®Œäº†æ™‚
justActivatedRef.current = true
setIsActivated(true)

// onTapå†…
if (justActivatedRef.current) {
  justActivatedRef.current = false
  return // é•·æŠ¼ã—çµ‚äº†ã®clickã‚’ç„¡è¦–
}
```

**3. é‡è¤‡ã‚¿ã‚¤ãƒãƒ¼é˜²æ­¢**

```typescript
const onPressStart = useCallback(() => {
  // å‰ã®ã‚¿ã‚¤ãƒãƒ¼ã‚’ã‚¯ãƒªã‚¢ï¼ˆé‡è¤‡é˜²æ­¢ï¼‰
  if (longPressTimerRef.current !== null) {
    clearTimeout(longPressTimerRef.current)
  }
  // æ–°ã—ã„ã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
  longPressTimerRef.current = setTimeout(...)
}, [])
```

**4. ãƒ¡ãƒ¢ãƒªãƒªãƒ¼ã‚¯é˜²æ­¢**

```typescript
useEffect(() => {
  isMountedRef.current = true
  return () => {
    isMountedRef.current = false
    clearAllTimers()
  }
}, [])
```

### 17.6 ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆGameBoard.tsxï¼‰

```typescript
<span
  className="select-none text-3xl"
  style={{ touchAction: 'none' }}  // ã‚¿ãƒƒãƒã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«é˜²æ­¢
  onPointerDown={(e) => {
    e.preventDefault()  // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå‹•ä½œé˜²æ­¢
    onPressStart()
  }}
  onPointerUp={onPressEnd}
  onPointerLeave={onPressEnd}   // é ˜åŸŸå¤–ã«å‡ºãŸå ´åˆ
  onPointerCancel={onPressEnd}  // ã‚·ã‚¹ãƒ†ãƒ ã‚­ãƒ£ãƒ³ã‚»ãƒ«
  onClick={(e) => {
    e.preventDefault()
    onTap()
  }}
  role="presentation"  // ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£
>
  ğŸƒ
</span>
```

**PointerEvents APIæ¡ç”¨ç†ç”±:**

- ãƒã‚¦ã‚¹ãƒ»ã‚¿ãƒƒãƒãƒ»ãƒšãƒ³å…¥åŠ›ã‚’çµ±ä¸€çš„ã«å‡¦ç†
- touch-action: noneã§ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ç«¶åˆã‚’é˜²æ­¢
- ã‚¯ãƒ­ã‚¹ãƒ–ãƒ©ã‚¦ã‚¶å¯¾å¿œ

### 17.7 è¦–è¦šãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯ï¼ˆRanking.tsxï¼‰

```typescript
<div
  className={`rounded-lg p-4 transition-colors duration-300 ${
    isSecretActivated ? 'bg-blue-100' : 'bg-gray-100'
  } ${className}`}
>
```

| çŠ¶æ…‹           | èƒŒæ™¯è‰²      | æ„å‘³                         |
| -------------- | ----------- | ---------------------------- |
| é€šå¸¸           | bg-gray-100 | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆçŠ¶æ…‹               |
| ã‚¢ã‚¯ãƒ†ã‚£ãƒ™ãƒ¼ãƒˆ | bg-blue-100 | ã‚¿ãƒƒãƒ—å—ä»˜ä¸­ï¼ˆç§˜åŒ¿çš„ãªå¤‰åŒ–ï¼‰ |

### 17.8 é·ç§»å…ˆãƒšãƒ¼ã‚¸ï¼ˆsrc/app/m/page.tsxï¼‰

```typescript
export default function MessengerPage(): React.JSX.Element {
  return (
    <div className="flex min-h-screen flex-col bg-gradient-to-b from-blue-800 to-blue-900 px-4 py-8">
      <header className="mb-6 flex items-center justify-between">
        <Link href="/" className="...">â† æˆ»ã‚‹</Link>
        <h1 className="text-2xl font-bold text-white">ãƒ•ãƒ¬ãƒ³ãƒ‰</h1>
      </header>
      <div className="flex flex-1 flex-col items-center justify-center">
        <div className="text-6xl">ğŸ’¬</div>
        <p className="mt-4 text-xl text-white">ãƒ¡ãƒƒã‚»ãƒ³ã‚¸ãƒ£ãƒ¼</p>
        <p className="mt-2 text-sm text-blue-200">ï¼ˆå®Ÿè£…äºˆå®šï¼‰</p>
      </div>
    </div>
  )
}
```

### 17.9 ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

| ã‚·ãƒŠãƒªã‚ª                     | æŒ™å‹•                   |
| ---------------------------- | ---------------------- |
| é•·æŠ¼ã—ä¸­ã«æŒ‡ã‚’é›¢ã™           | é™ã‹ã«ãƒªã‚»ãƒƒãƒˆ         |
| ã‚¿ãƒƒãƒ—å—ä»˜æ™‚é–“ï¼ˆ2ç§’ï¼‰è¶…é    | é™ã‹ã«ãƒªã‚»ãƒƒãƒˆ         |
| 3å›ã‚¿ãƒƒãƒ—åˆ¶é™æ™‚é–“ï¼ˆ1ç§’ï¼‰è¶…é | é™ã‹ã«ãƒªã‚»ãƒƒãƒˆ         |
| ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚¢ãƒ³ãƒã‚¦ãƒ³ãƒˆ   | å…¨ã‚¿ã‚¤ãƒãƒ¼ã‚¯ãƒªã‚¢       |
| router.pushå¤±æ•—              | Next.jsã®404ãƒšãƒ¼ã‚¸è¡¨ç¤º |

### 17.10 ãƒ†ã‚¹ãƒˆä»•æ§˜

**å›å¸°ãƒ†ã‚¹ãƒˆ: 2025-02-06-001-secret-gesture.test.ts**

```typescript
describe('Regression: ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼', () => {
  // ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†
  it('should have proper timer cleanup on unmount pattern')
  it('should prevent duplicate timers on rapid press')

  // ã‚¯ãƒ­ãƒ¼ã‚¸ãƒ£ãƒ¼å•é¡Œ
  it('should track latest value with useRef pattern')

  // ãƒã‚¦ãƒ³ãƒˆçŠ¶æ…‹è¿½è·¡
  it('should prevent state update after unmount')

  // ã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ãƒ•ãƒ­ãƒ¼
  it('should complete gesture sequence: long press â†’ activate â†’ tap 3 times')
  it('should reset on tap timeout')
})
```

## 18. ã‚²ãƒ¼ãƒ æ©Ÿèƒ½ãƒ­ãƒƒã‚¯ãƒ€ã‚¦ãƒ³ä»•æ§˜ï¼ˆv1.0.0ï¼‰

### 18.1 æ¦‚è¦

v1.0.0ã§ã‚²ãƒ¼ãƒ æ©Ÿèƒ½ã®å…¨ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å®‰å®šåŒ–ã—ã€3å±¤ã®ä¿è­·ãƒ¡ã‚«ãƒ‹ã‚ºãƒ ã§å¤‰æ›´ã‚’é˜²æ­¢ã™ã‚‹ã€‚

| é …ç›®                     | å€¤                  |
| ------------------------ | ------------------- |
| **å®‰å®šåŒ–ãƒãƒ¼ã‚¸ãƒ§ãƒ³**     | v1.0.0              |
| **å®‰å®šåŒ–æ—¥**             | 2026-02-07          |
| **ä¿è­·å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«æ•°**   | 11                  |
| **ãƒ­ãƒƒã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚¹ãƒˆæ•°** | 65                  |
| **ãƒ‡ãƒ—ãƒ­ã‚¤å…ˆ**           | Vercel (Production) |

### 18.2 3å±¤ä¿è­·ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Layer 1: Git Tag v1.0.0                                  â”‚
â”‚ â†’ ã„ã¤ã§ã‚‚ git checkout v1.0.0 ã§å®‰å®šç‰ˆã«å¾©å…ƒå¯èƒ½        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 2a: ãƒ‘ã‚¹ä¿è­·ï¼ˆcheck-protected-features.jsï¼‰        â”‚
â”‚ â†’ .claude/protected-features.json ã§ä¿è­·ãƒ‘ã‚¹ã‚’å®šç¾©       â”‚
â”‚ â†’ ã‚³ãƒŸãƒƒãƒˆæ™‚ã«ä¿è­·ãƒ‘ã‚¹å†…ã®ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’æ¤œå‡ºãƒ»ãƒ–ãƒ­ãƒƒã‚¯   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 2b: ãƒã‚§ãƒƒã‚¯ã‚µãƒ ä¿è­·ï¼ˆprotect-game-checksums.jsï¼‰   â”‚
â”‚ â†’ 11ãƒ•ã‚¡ã‚¤ãƒ«ã®SHA256ãƒã‚§ãƒƒã‚¯ã‚µãƒ ã‚’æ¤œè¨¼                    â”‚
â”‚ â†’ å†…å®¹ã®æ”¹å¤‰ã‚’æ¤œå‡ºãƒ»ãƒ–ãƒ­ãƒƒã‚¯                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Layer 3: ãƒ­ãƒƒã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚¹ãƒˆï¼ˆ65ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰             â”‚
â”‚ â†’ å®šæ•°å€¤ãƒ»APIè¡¨é¢ãƒ»ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ã®å¤‰æ›´ã‚’æ¤œå‡º             â”‚
â”‚ â†’ ãƒ†ã‚¹ãƒˆå¤±æ•— = ã‚³ãƒŸãƒƒãƒˆä¸å¯ï¼ˆpre-commit hookï¼‰            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 18.3 ä¿è­·å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ«ä¸€è¦§

| ãƒ•ã‚¡ã‚¤ãƒ«                                      | å½¹å‰²                     | SHA256ä¿è­· | ãƒ‘ã‚¹ä¿è­· |
| --------------------------------------------- | ------------------------ | ---------- | -------- |
| `src/features/game/index.ts`                  | å…¬é–‹API                  | Yes        | Yes      |
| `src/features/game/components/Card.tsx`       | ã‚«ãƒ¼ãƒ‰è¡¨ç¤º               | Yes        | Yes      |
| `src/features/game/components/GameBoard.tsx`  | ã‚²ãƒ¼ãƒ ãƒœãƒ¼ãƒ‰             | Yes        | Yes      |
| `src/features/game/components/Ranking.tsx`    | ãƒ©ãƒ³ã‚­ãƒ³ã‚°               | Yes        | Yes      |
| `src/features/game/hooks/useGame.ts`          | ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯           | Yes        | Yes      |
| `src/features/game/hooks/useSecretGesture.ts` | ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ | Yes        | Yes      |
| `src/features/game/constants/index.ts`        | å®šæ•°å®šç¾©                 | Yes        | Yes      |
| `src/features/game/types/index.ts`            | å‹å®šç¾©                   | Yes        | Yes      |
| `src/app/page.tsx`                            | ã‚²ãƒ¼ãƒ ã‚¨ãƒ³ãƒˆãƒª           | Yes        | Yes      |
| `src/app/m/page.tsx`                          | ãƒ¡ãƒƒã‚»ãƒ³ã‚¸ãƒ£ãƒ¼           | Yes        | Yes      |
| `src/components/ErrorBoundary.tsx`            | ã‚¨ãƒ©ãƒ¼å¢ƒç•Œ               | Yes        | Yes      |

### 18.4 ãƒ‘ã‚¹ä¿è­·è¨­å®šï¼ˆ.claude/protected-features.jsonï¼‰

```json
{
  "protectedFeatures": [
    {
      "name": "game",
      "description": "Hi & Low ã‚«ãƒ¼ãƒ‰ã‚²ãƒ¼ãƒ æ©Ÿèƒ½ï¼ˆv1.0.0ã§å®‰å®šåŒ–æ¸ˆã¿ï¼‰",
      "paths": [
        "src/features/game/",
        "src/app/page.tsx",
        "src/app/m/",
        "src/components/ErrorBoundary.tsx"
      ],
      "protection": "strict",
      "allowFlags": ["--allow-game-changes"]
    }
  ],
  "globalSettings": {
    "strictMode": true,
    "emergencyBypass": "--emergency-override"
  }
}
```

### 18.5 ãƒã‚§ãƒƒã‚¯ã‚µãƒ ä¿è­·ã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆscripts/protect-game-checksums.jsï¼‰

**ã‚³ãƒãƒ³ãƒ‰:**

| ã‚³ãƒãƒ³ãƒ‰                   | èª¬æ˜                           |
| -------------------------- | ------------------------------ |
| `pnpm protect:game`        | ãƒã‚§ãƒƒã‚¯ã‚µãƒ æ¤œè¨¼å®Ÿè¡Œ           |
| `pnpm protect:game:init`   | ãƒã‚§ãƒƒã‚¯ã‚µãƒ åˆæœŸåŒ–             |
| `pnpm protect:game:update` | æ„å›³çš„å¤‰æ›´å¾Œã®ãƒã‚§ãƒƒã‚¯ã‚µãƒ æ›´æ–° |
| `pnpm check:protected`     | ãƒ‘ã‚¹ä¿è­·ãƒã‚§ãƒƒã‚¯å®Ÿè¡Œ           |

**ãƒã‚§ãƒƒã‚¯ã‚µãƒ ä¿å­˜å…ˆ:** `scripts/.game-checksums.json`

**ãƒã‚¤ãƒ‘ã‚¹æ–¹æ³•:**

| æ–¹æ³•                                              | ç”¨é€”                           |
| ------------------------------------------------- | ------------------------------ |
| `ALLOW_GAME_CHANGES=1 git commit`                 | ãƒã‚§ãƒƒã‚¯ã‚µãƒ ä¿è­·ã®ã‚¹ã‚­ãƒƒãƒ—     |
| ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã« `--allow-game-changes`       | ãƒ‘ã‚¹ä¿è­·ã®ã‚¹ã‚­ãƒƒãƒ—             |
| ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã« `--emergency-override`       | å…¨ä¿è­·ã®ã‚¹ã‚­ãƒƒãƒ—ï¼ˆç·Šæ€¥æ™‚ã®ã¿ï¼‰ |
| `node scripts/protect-game-checksums.js --update` | ãƒã‚§ãƒƒã‚¯ã‚µãƒ å†è¨ˆç®—             |

### 18.6 pre-commitãƒ•ãƒƒã‚¯å®Ÿè¡Œé †åº

```
1. protect-config.js              # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¿è­·ï¼ˆæ—¢å­˜ï¼‰
2. check-protected-features.js    # ãƒ‘ã‚¹ä¿è­·ï¼ˆv1.0.0è¿½åŠ ï¼‰
3. protect-game-checksums.js      # ãƒã‚§ãƒƒã‚¯ã‚µãƒ ä¿è­·ï¼ˆv1.0.0è¿½åŠ ï¼‰
4. å˜ä¸€ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼ãƒã‚§ãƒƒã‚¯        # è¤‡æ•°ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼åŒæ™‚ã‚³ãƒŸãƒƒãƒˆé˜²æ­¢ï¼ˆæ—¢å­˜ï¼‰
5. check:boundaries               # å¢ƒç•Œé•åæ¤œå‡ºï¼ˆæ—¢å­˜ï¼‰
6. lint-staged                    # ESLint + Prettierï¼ˆæ—¢å­˜ï¼‰
7. test:unit                      # å…¨ãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼ˆæ—¢å­˜ï¼‰
```

### 18.7 ãƒ­ãƒƒã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚¹ãƒˆä»•æ§˜

#### 2026-02-07-001: å®šæ•°ãƒ­ãƒƒã‚¯ï¼ˆ20ãƒ†ã‚¹ãƒˆï¼‰

| ãƒ†ã‚¹ãƒˆå¯¾è±¡      | æ¤œè¨¼å†…å®¹                                               |
| --------------- | ------------------------------------------------------ |
| SUITS           | 4ã‚¹ãƒ¼ãƒˆã®é †åºã¨å€¤                                      |
| SUIT_EMOJI      | å„ã‚¹ãƒ¼ãƒˆã®çµµæ–‡å­—ãƒãƒƒãƒ”ãƒ³ã‚°                             |
| SUIT_COLOR      | Tailwind CSSã‚¯ãƒ©ã‚¹ãƒãƒƒãƒ”ãƒ³ã‚°                           |
| VALUE_DISPLAY   | A-Kï¼ˆ13æšï¼‰ã®è¡¨ç¤ºæ–‡å­—                                  |
| RANKING_DATA    | 5åã®ãƒ©ãƒ³ã‚­ãƒ³ã‚°ï¼ˆåå‰ãƒ»ã‚¹ã‚³ã‚¢ãƒ»é †åºï¼‰                  |
| INITIAL_COINS   | åˆæœŸå€¤10                                               |
| ANIMATION_DELAY | REVEAL=500ms, NEXT_ROUND=1000ms                        |
| STORAGE_KEY     | HIGH_SCORE, COINS ã®ã‚­ãƒ¼æ–‡å­—åˆ—                         |
| TOAST_CONFIG    | ENTER_DELAY=50, DISPLAY_DURATION=3000, HIDE_DELAY=3500 |

#### 2026-02-07-002: APIè¡¨é¢ãƒ­ãƒƒã‚¯ï¼ˆ13ãƒ†ã‚¹ãƒˆï¼‰

| ãƒ†ã‚¹ãƒˆå¯¾è±¡     | æ¤œè¨¼å†…å®¹                                               |
| -------------- | ------------------------------------------------------ |
| ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ   | GameBoardã®ã¿ï¼ˆ1ã¤ï¼‰                                   |
| GameBoard      | é–¢æ•°å‹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã§ã‚ã‚‹ã“ã¨                         |
| å†…éƒ¨æ¼æ´©é˜²æ­¢   | useGame, useSecretGesture, Card, Ranking, å®šæ•°ãŒéå…¬é–‹ |
| RankingEntryå‹ | rank, name, score ã®3ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£æ§‹é€                     |

#### 2026-02-07-003: ã‚²ãƒ¼ãƒ ãƒ­ã‚¸ãƒƒã‚¯ãƒ­ãƒƒã‚¯ï¼ˆ32ãƒ†ã‚¹ãƒˆï¼‰

| ãƒ†ã‚¹ãƒˆå¯¾è±¡       | æ¤œè¨¼å†…å®¹                                                          |
| ---------------- | ----------------------------------------------------------------- |
| å‹æ•—åˆ¤å®š         | HIGH/LOWäºˆæƒ³ã¨çµæœã®çµ„ã¿åˆã‚ã›ï¼ˆ6ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰                       |
| ã‚³ã‚¤ãƒ³è¨ˆç®—       | æ¶ˆè²»ãƒ»ç²å¾—ãƒ»è¿”å´ãƒ»ã‚²ãƒ¼ãƒ ã‚ªãƒ¼ãƒãƒ¼ï¼ˆ9ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰                     |
| çŠ¶æ…‹é·ç§»         | won/lost/draw/gameoverï¼ˆ4ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰                               |
| ã‚«ãƒ¼ãƒ‰å‹         | CardValue, Suit, Card, Guess, GameState ã®æ§‹é€ ï¼ˆ5ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰       |
| ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆè¨­å®š | 3000msé•·æŠ¼ã—, 2000msã‚¿ãƒƒãƒ—çª“, 1000msã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ, 3ã‚¿ãƒƒãƒ—, /mé·ç§» |
| ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸       | ã‚­ãƒ¼æ–‡å­—åˆ—ã®ä¸€è‡´ï¼ˆ2ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰                                     |

### 18.8 æ„å›³çš„ãªå¤‰æ›´æ‰‹é †

ã‚²ãƒ¼ãƒ æ©Ÿèƒ½ã‚’æ„å›³çš„ã«å¤‰æ›´ã™ã‚‹å ´åˆã®æ‰‹é †ï¼š

```bash
# 1. å¤‰æ›´ã‚’å®Ÿæ–½
# 2. ãƒã‚§ãƒƒã‚¯ã‚µãƒ ã‚’æ›´æ–°
node scripts/protect-game-checksums.js --update

# 3. ãƒ­ãƒƒã‚¯ãƒ€ã‚¦ãƒ³ãƒ†ã‚¹ãƒˆã‚’æ›´æ–°ï¼ˆå€¤ãŒå¤‰ã‚ã£ãŸå ´åˆï¼‰
# tests/regression/2026-02-07-*.test.ts ã‚’ä¿®æ­£

# 4. ãƒ‘ã‚¹ä¿è­·ã‚’ãƒã‚¤ãƒ‘ã‚¹ã—ã¦ã‚³ãƒŸãƒƒãƒˆ
git commit -m "feat(game): æ©Ÿèƒ½æ”¹å–„ --allow-game-changes"

# 5. ã‚¿ã‚°ã‚’æ›´æ–°ï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
git tag -a v1.1.0 -m "v1.1.0: ã‚²ãƒ¼ãƒ æ©Ÿèƒ½æ›´æ–°"
```

## 19. ãƒ‡ãƒ—ãƒ­ã‚¤æƒ…å ±

### 19.1 Vercelè¨­å®š

| é …ç›®                  | å€¤                      |
| --------------------- | ----------------------- |
| **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå**    | hi-and-low-game         |
| **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **  | Vercel                  |
| **ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰**    | `pnpm build`            |
| **å‡ºåŠ›ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª**  | `.next`                 |
| **Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³** | 20.x                    |
| **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**        | iad1 (Washington, D.C.) |

### 19.2 ãƒšãƒ¼ã‚¸æ§‹æˆ

| ãƒ«ãƒ¼ãƒˆ                              | ç¨®åˆ¥    | èª¬æ˜                                 |
| ----------------------------------- | ------- | ------------------------------------ |
| `/`                                 | Static  | ã‚²ãƒ¼ãƒ ãƒ¡ã‚¤ãƒ³ãƒšãƒ¼ã‚¸                   |
| `/m`                                | Dynamic | ãƒˆãƒ¼ã‚¯ä¸€è¦§ï¼ˆãƒ¡ãƒƒã‚»ãƒ³ã‚¸ãƒ£ãƒ¼ãƒˆãƒƒãƒ—ï¼‰   |
| `/m/login`                          | Dynamic | ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸                       |
| `/m/signup`                         | Dynamic | ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒšãƒ¼ã‚¸                   |
| `/m/chat/[conversationId]`          | Dynamic | ãƒãƒ£ãƒƒãƒˆãƒšãƒ¼ã‚¸                       |
| `/m/chat/[conversationId]/settings` | Dynamic | ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®šãƒšãƒ¼ã‚¸                   |
| `/m/friends`                        | Dynamic | ãƒ•ãƒ¬ãƒ³ãƒ‰ä¸€è¦§                         |
| `/m/friends/add`                    | Dynamic | ãƒ•ãƒ¬ãƒ³ãƒ‰è¿½åŠ ï¼ˆQRã‚³ãƒ¼ãƒ‰ï¼‹ã‚³ãƒ¼ãƒ‰å…¥åŠ›ï¼‰ |
| `/m/profile`                        | Dynamic | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ãƒ»è¨­å®š                   |
| `/m/search`                         | Dynamic | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¤œç´¢                       |
| `/m/admin`                          | Dynamic | ç®¡ç†ãƒ‘ãƒãƒ«ï¼ˆadminé™å®šï¼‰              |
| `/m/group/create`                   | Dynamic | ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆ                         |
| `/m/group/invite/[code]`            | Dynamic | ã‚°ãƒ«ãƒ¼ãƒ—æ‹›å¾…ãƒªãƒ³ã‚¯                   |
| `/m/add/[friendCode]`               | Dynamic | URLçµŒç”±ãƒ•ãƒ¬ãƒ³ãƒ‰è¿½åŠ                   |
| `/_not-found`                       | Static  | 404ãƒšãƒ¼ã‚¸                            |

### 19.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹

| æŒ‡æ¨™                   | å€¤                   |
| ---------------------- | -------------------- |
| First Load JS (shared) | 102 kB               |
| ãƒ“ãƒ«ãƒ‰æ™‚é–“             | ~3.6ç§’ï¼ˆã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ï¼‰ |
| é™çš„ãƒšãƒ¼ã‚¸ç”Ÿæˆ         | 5ãƒšãƒ¼ã‚¸              |

## 20. ãƒ¡ãƒƒã‚»ãƒ³ã‚¸ãƒ£ãƒ¼æ©Ÿèƒ½ï¼ˆLINEé¢¨ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒªï¼‰

ã‚²ãƒ¼ãƒ ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ï¼ˆS17å‚ç…§ï¼‰çµŒç”±ã§ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªLINEé¢¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ³ã‚°ã‚¢ãƒ—ãƒªã€‚
Supabaseã‚’ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã¨ã—ã¦ä½¿ç”¨ã—ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ é€šä¿¡ãƒ»èªè¨¼ãƒ»ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’å®Ÿè£…ã€‚

### 20.1 Supabaseãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ

| é …ç›®                   | å€¤                                            |
| ---------------------- | --------------------------------------------- |
| **ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆID**     | `cyoitqodgybqybciokbx`                        |
| **ãƒªãƒ¼ã‚¸ãƒ§ãƒ³**         | ap-northeast-1ï¼ˆæ±äº¬ï¼‰                        |
| **èªè¨¼æ–¹å¼**           | Email/Password                                |
| **Realtimeæœ‰åŠ¹**       | messages, conversations, conversation_members |
| **ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒã‚±ãƒƒãƒˆ** | `message-images`                              |

### 20.2 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

#### 20.2.1 profiles ãƒ†ãƒ¼ãƒ–ãƒ«

| ã‚«ãƒ©ãƒ          | å‹          | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ  | NOT NULL | åˆ¶ç´„                            |
| -------------- | ----------- | ----------- | -------- | ------------------------------- |
| `id`           | uuid        | -           | YES      | PK, FK â†’ auth.users(id) CASCADE |
| `display_name` | text        | -           | YES      | -                               |
| `avatar_text`  | text        | `'?'`       | YES      | -                               |
| `avatar_color` | text        | `'#3B82F6'` | YES      | -                               |
| `friend_code`  | text        | -           | YES      | UNIQUE                          |
| `is_admin`     | boolean     | `false`     | YES      | -                               |
| `created_at`   | timestamptz | `now()`     | YES      | -                               |
| `updated_at`   | timestamptz | `now()`     | YES      | ãƒˆãƒªã‚¬ãƒ¼ã§è‡ªå‹•æ›´æ–°              |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: `idx_profiles_friend_code(friend_code)`

#### 20.2.2 friendships ãƒ†ãƒ¼ãƒ–ãƒ«

| ã‚«ãƒ©ãƒ        | å‹          | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ          | NOT NULL | åˆ¶ç´„                      |
| ------------ | ----------- | ------------------- | -------- | ------------------------- |
| `id`         | uuid        | `gen_random_uuid()` | YES      | PK                        |
| `user_id`    | uuid        | -                   | YES      | FK â†’ profiles(id) CASCADE |
| `friend_id`  | uuid        | -                   | YES      | FK â†’ profiles(id) CASCADE |
| `created_at` | timestamptz | `now()`             | YES      | -                         |

**åˆ¶ç´„**: `UNIQUE(user_id, friend_id)`, `CHECK(user_id != friend_id)`
**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: `idx_friendships_user_id`, `idx_friendships_friend_id`
**ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«**: åŒæ–¹å‘ï¼ˆAâ†’Bè¿½åŠ æ™‚ã«Bâ†’Aã‚‚åŒæ™‚ä½œæˆï¼‰

#### 20.2.3 conversations ãƒ†ãƒ¼ãƒ–ãƒ«

| ã‚«ãƒ©ãƒ         | å‹          | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ          | NOT NULL | åˆ¶ç´„                           |
| ------------- | ----------- | ------------------- | -------- | ------------------------------ |
| `id`          | uuid        | `gen_random_uuid()` | YES      | PK                             |
| `type`        | text        | -                   | YES      | CHECK: `'direct'` or `'group'` |
| `name`        | text        | -                   | NO       | ã‚°ãƒ«ãƒ¼ãƒ—åï¼ˆdirectæ™‚ã¯NULLï¼‰   |
| `icon_text`   | text        | -                   | NO       | ã‚°ãƒ«ãƒ¼ãƒ—ã‚¢ã‚¤ã‚³ãƒ³æ–‡å­—           |
| `icon_color`  | text        | -                   | NO       | ã‚°ãƒ«ãƒ¼ãƒ—ã‚¢ã‚¤ã‚³ãƒ³è‰²             |
| `invite_code` | text        | -                   | NO       | UNIQUE, ã‚°ãƒ«ãƒ¼ãƒ—æ‹›å¾…ã‚³ãƒ¼ãƒ‰     |
| `created_by`  | uuid        | -                   | NO       | FK â†’ profiles(id) SET NULL     |
| `created_at`  | timestamptz | `now()`             | YES      | -                              |
| `updated_at`  | timestamptz | `now()`             | YES      | ãƒˆãƒªã‚¬ãƒ¼ã§è‡ªå‹•æ›´æ–°             |

**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: `idx_conversations_invite_code`, `idx_conversations_type`

#### 20.2.4 conversation_members ãƒ†ãƒ¼ãƒ–ãƒ«

| ã‚«ãƒ©ãƒ             | å‹          | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ          | NOT NULL | åˆ¶ç´„                           |
| ----------------- | ----------- | ------------------- | -------- | ------------------------------ |
| `id`              | uuid        | `gen_random_uuid()` | YES      | PK                             |
| `conversation_id` | uuid        | -                   | YES      | FK â†’ conversations(id) CASCADE |
| `user_id`         | uuid        | -                   | YES      | FK â†’ profiles(id) CASCADE      |
| `last_read_at`    | timestamptz | `now()`             | YES      | æ—¢èª­ç®¡ç†ç”¨                     |
| `joined_at`       | timestamptz | `now()`             | YES      | -                              |

**åˆ¶ç´„**: `UNIQUE(conversation_id, user_id)`
**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: `idx_conversation_members_conversation`, `idx_conversation_members_user`

#### 20.2.5 messages ãƒ†ãƒ¼ãƒ–ãƒ«

| ã‚«ãƒ©ãƒ             | å‹          | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ          | NOT NULL | åˆ¶ç´„                           |
| ----------------- | ----------- | ------------------- | -------- | ------------------------------ |
| `id`              | uuid        | `gen_random_uuid()` | YES      | PK                             |
| `conversation_id` | uuid        | -                   | YES      | FK â†’ conversations(id) CASCADE |
| `sender_id`       | uuid        | -                   | YES      | FK â†’ profiles(id) CASCADE      |
| `content`         | text        | -                   | NO       | ãƒ†ã‚­ã‚¹ãƒˆæœ¬æ–‡                   |
| `image_url`       | text        | -                   | NO       | ç”»åƒURL                        |
| `reply_to_id`     | uuid        | -                   | NO       | FK â†’ messages(id) SET NULL     |
| `is_deleted`      | boolean     | `false`             | YES      | ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆ                 |
| `created_at`      | timestamptz | `now()`             | YES      | -                              |

**åˆ¶ç´„**: `CHECK(content IS NOT NULL OR image_url IS NOT NULL OR is_deleted = TRUE)`
**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: `idx_messages_conversation(conversation_id, created_at DESC)`, `idx_messages_sender`, `idx_messages_reply_to WHERE reply_to_id IS NOT NULL`

#### 20.2.6 message_reactions ãƒ†ãƒ¼ãƒ–ãƒ«

| ã‚«ãƒ©ãƒ        | å‹          | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ          | NOT NULL | åˆ¶ç´„                      |
| ------------ | ----------- | ------------------- | -------- | ------------------------- |
| `id`         | uuid        | `gen_random_uuid()` | YES      | PK                        |
| `message_id` | uuid        | -                   | YES      | FK â†’ messages(id) CASCADE |
| `user_id`    | uuid        | -                   | YES      | FK â†’ profiles(id) CASCADE |
| `emoji`      | text        | -                   | YES      | CHECK: `'ğŸ‘'` or `'âœ…'`   |
| `created_at` | timestamptz | `now()`             | YES      | -                         |

**åˆ¶ç´„**: `UNIQUE(message_id, user_id, emoji)`
**ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹**: `idx_message_reactions_message`

### 20.3 ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹é–¢æ•°

#### `generate_friend_code() â†’ text`

8æ–‡å­—ã®ãƒ©ãƒ³ãƒ€ãƒ æ–‡å­—åˆ—ã‚’ç”Ÿæˆã€‚ç´›ã‚‰ã‚ã—ã„æ–‡å­—ï¼ˆ`I`,`l`,`O`,`0`,`1`ï¼‰ã‚’é™¤å¤–ã€‚

```sql
chars = 'ABCDEFGHJKLMNPQRSTUVWXYZabcdefghjkmnpqrstuvwxyz23456789'
```

#### `handle_new_user() â†’ trigger` (SECURITY DEFINER)

`auth.users` INSERTæ™‚ã«è‡ªå‹•å®Ÿè¡Œã€‚ãƒ¦ãƒ‹ãƒ¼ã‚¯ãªãƒ•ãƒ¬ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã€profilesã«æ–°è¦ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’ä½œæˆã€‚

- `display_name`: `raw_user_meta_data->>'display_name'` ã¾ãŸã¯ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ`'ãƒ¦ãƒ¼ã‚¶ãƒ¼'`
- ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã¯LOOPã§ãƒ¦ãƒ‹ãƒ¼ã‚¯æ€§ã‚’ä¿è¨¼

#### `handle_updated_at() â†’ trigger`

UPDATEæ™‚ã«`updated_at`ã‚’`now()`ã«æ›´æ–°ã€‚profiles, conversationsã«é©ç”¨ã€‚

#### `is_conversation_member(conv_id uuid) â†’ boolean` (SECURITY DEFINER, STABLE)

æŒ‡å®šã—ãŸä¼šè©±ã«`auth.uid()`ãŒãƒ¡ãƒ³ãƒãƒ¼ã¨ã—ã¦å‚åŠ ã—ã¦ã„ã‚‹ã‹åˆ¤å®šã€‚RLSãƒãƒªã‚·ãƒ¼ã®å†å¸°å›é¿ã«ä½¿ç”¨ã€‚

#### `user_conversation_ids() â†’ SETOF uuid` (SECURITY DEFINER, STABLE)

`auth.uid()`ãŒå‚åŠ ã™ã‚‹å…¨ä¼šè©±IDã‚’è¿”ã™ã€‚conversation_members SELECTãƒãƒªã‚·ãƒ¼ã§ä½¿ç”¨ã€‚

### 20.4 ãƒˆãƒªã‚¬ãƒ¼

| ãƒˆãƒªã‚¬ãƒ¼å                 | ãƒ†ãƒ¼ãƒ–ãƒ«        | ã‚¤ãƒ™ãƒ³ãƒˆ      | é–¢æ•°                |
| -------------------------- | --------------- | ------------- | ------------------- |
| `on_auth_user_created`     | `auth.users`    | AFTER INSERT  | `handle_new_user`   |
| `on_profiles_updated`      | `profiles`      | BEFORE UPDATE | `handle_updated_at` |
| `on_conversations_updated` | `conversations` | BEFORE UPDATE | `handle_updated_at` |

### 20.5 RLSãƒãƒªã‚·ãƒ¼

å…¨ãƒ†ãƒ¼ãƒ–ãƒ«ã§RLSæœ‰åŠ¹ã€‚ç®¡ç†è€…ï¼ˆ`is_admin = true`ï¼‰ã¯SELECTã§å…¨ãƒ‡ãƒ¼ã‚¿é–²è¦§å¯èƒ½ã€‚

#### profiles

| ãƒãƒªã‚·ãƒ¼å            | æ“ä½œ   | æ¡ä»¶                 |
| --------------------- | ------ | -------------------- |
| `profiles_select_all` | SELECT | `true`ï¼ˆå…¨å“¡é–²è¦§å¯ï¼‰ |
| `profiles_insert_own` | INSERT | `auth.uid() = id`    |
| `profiles_update_own` | UPDATE | `auth.uid() = id`    |

#### friendships

| ãƒãƒªã‚·ãƒ¼å               | æ“ä½œ   | æ¡ä»¶                                             |
| ------------------------ | ------ | ------------------------------------------------ |
| `friendships_select_own` | SELECT | `auth.uid() = user_id OR auth.uid() = friend_id` |
| `friendships_insert_own` | INSERT | `auth.uid() = user_id OR auth.uid() = friend_id` |
| `friendships_delete_own` | DELETE | `auth.uid() = user_id OR auth.uid() = friend_id` |

#### conversations

| ãƒãƒªã‚·ãƒ¼å                    | æ“ä½œ   | æ¡ä»¶                                     |
| ----------------------------- | ------ | ---------------------------------------- |
| `conversations_select_member` | SELECT | `is_conversation_member(id) OR is_admin` |
| `conversations_insert_auth`   | INSERT | `auth.uid() IS NOT NULL`                 |
| `conversations_update_member` | UPDATE | `is_conversation_member(id)`             |

#### conversation_members

| ãƒãƒªã‚·ãƒ¼å                        | æ“ä½œ   | æ¡ä»¶                                                       |
| --------------------------------- | ------ | ---------------------------------------------------------- |
| `conversation_members_select`     | SELECT | `conversation_id IN (user_conversation_ids()) OR is_admin` |
| `conversation_members_insert`     | INSERT | `auth.uid() IS NOT NULL`                                   |
| `conversation_members_update_own` | UPDATE | `auth.uid() = user_id`                                     |
| `conversation_members_delete_own` | DELETE | `auth.uid() = user_id`                                     |

#### messages

| ãƒãƒªã‚·ãƒ¼å               | æ“ä½œ   | æ¡ä»¶                                                         |
| ------------------------ | ------ | ------------------------------------------------------------ |
| `messages_select_member` | SELECT | `is_conversation_member(conversation_id) OR is_admin`        |
| `messages_insert_member` | INSERT | `auth.uid() = sender_id AND is_conversation_member(conv_id)` |
| `messages_update_delete` | UPDATE | `is_conversation_member(conversation_id) OR is_admin`        |

#### message_reactions

| ãƒãƒªã‚·ãƒ¼å                | æ“ä½œ   | æ¡ä»¶                                                         |
| ------------------------- | ------ | ------------------------------------------------------------ |
| `reactions_select_member` | SELECT | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ‰€å±ä¼šè©±ã®ãƒ¡ãƒ³ãƒãƒ¼ï¼ˆ`is_conversation_member`çµŒç”±ï¼‰ |
| `reactions_insert_member` | INSERT | `auth.uid() = user_id` ã‹ã¤ä¼šè©±ãƒ¡ãƒ³ãƒãƒ¼                      |
| `reactions_delete_own`    | DELETE | `auth.uid() = user_id`                                       |

### 20.6 Realtime Publication

```sql
ALTER PUBLICATION supabase_realtime ADD TABLE messages;
ALTER PUBLICATION supabase_realtime ADD TABLE conversations;
ALTER PUBLICATION supabase_realtime ADD TABLE conversation_members;
```

### 20.7 ãƒ•ã‚£ãƒ¼ãƒãƒ£ãƒ¼æ§‹é€ 

```
src/features/messenger/
â”œâ”€â”€ api/
â”‚   â”œâ”€â”€ auth.ts            # èªè¨¼APIï¼ˆsignUp, login, logout, getCurrentUser, getProfile, updateProfileï¼‰
â”‚   â”œâ”€â”€ friends.ts         # ãƒ•ãƒ¬ãƒ³ãƒ‰APIï¼ˆgetFriends, addFriendByCode, getProfileByFriendCode, removeFriendï¼‰
â”‚   â”œâ”€â”€ conversations.ts   # ä¼šè©±APIï¼ˆgetConversations, createDirectConversation, createGroupConversationç­‰ï¼‰
â”‚   â”œâ”€â”€ messages.ts        # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸APIï¼ˆgetMessages, sendMessage, deleteMessage, markAsReadï¼‰
â”‚   â”œâ”€â”€ reactions.ts       # ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³APIï¼ˆaddReaction, removeReactionï¼‰
â”‚   â””â”€â”€ storage.ts         # ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸APIï¼ˆuploadImageï¼‰
â”œâ”€â”€ components/
â”‚   â”œâ”€â”€ AuthProvider.tsx   # èªè¨¼ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆAuthProvider + useAuthContextï¼‰
â”‚   â””â”€â”€ ProfileAvatar.tsx  # ã‚¢ãƒã‚¿ãƒ¼è¡¨ç¤ºã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
â”œâ”€â”€ hooks/
â”‚   â”œâ”€â”€ useAuth.ts         # èªè¨¼çŠ¶æ…‹ç®¡ç†ãƒ•ãƒƒã‚¯
â”‚   â”œâ”€â”€ useConversations.ts # ä¼šè©±ä¸€è¦§ãƒ•ãƒƒã‚¯
â”‚   â””â”€â”€ useMessages.ts     # ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ç®¡ç†ãƒ•ãƒƒã‚¯
â”œâ”€â”€ utils/
â”‚   â””â”€â”€ dateFormat.ts      # æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
â”œâ”€â”€ constants/
â”‚   â””â”€â”€ index.ts           # å®šæ•°å®šç¾©
â”œâ”€â”€ types/
â”‚   â””â”€â”€ index.ts           # å‹å®šç¾©
â””â”€â”€ index.ts               # å…¬é–‹API
```

### 20.8 å‹å®šç¾©

```typescript
// Database Row Typesï¼ˆSupabaseè‡ªå‹•ç”Ÿæˆå‹ã‹ã‚‰å–å¾—ï¼‰
type Profile = Database['public']['Tables']['profiles']['Row']
type Friendship = Database['public']['Tables']['friendships']['Row']
type Conversation = Database['public']['Tables']['conversations']['Row']
type ConversationMember = Database['public']['Tables']['conversation_members']['Row']
type Message = Database['public']['Tables']['messages']['Row']
type MessageReaction = Database['public']['Tables']['message_reactions']['Row']

// Insert/Update Types
type ProfileInsert = Database['public']['Tables']['profiles']['Insert']
type ProfileUpdate = Database['public']['Tables']['profiles']['Update']
type MessageInsert = Database['public']['Tables']['messages']['Insert']
type MessageUpdate = Database['public']['Tables']['messages']['Update']
// ä»–ãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚åŒæ§˜ã«Insertå‹ã‚’å®šç¾©

// ãƒ‰ãƒ¡ã‚¤ãƒ³å‹
type ConversationType = 'direct' | 'group'
type ReactionEmoji = 'ğŸ‘' | 'âœ…'

interface ConversationWithDetails {
  readonly conversation: Conversation
  readonly members: readonly (ConversationMember & { readonly profile: Profile })[]
  readonly latestMessage: Message | null
  readonly unreadCount: number
}

interface MessageWithDetails {
  readonly message: Message
  readonly sender: Profile
  readonly reactions: readonly (MessageReaction & { readonly user: Profile })[]
  readonly replyTo: (Message & { readonly sender: Profile }) | null
}

interface AuthState {
  readonly user: Profile | null
  readonly isLoading: boolean
  readonly isAuthenticated: boolean
}

interface SignUpFormData {
  readonly email: string
  readonly password: string
  readonly displayName: string
}

interface LoginFormData {
  readonly email: string
  readonly password: string
}
```

### 20.9 å®šæ•°å®šç¾©

| å®šæ•°å                   | å€¤                                                                                  | èª¬æ˜                   |
| ------------------------ | ----------------------------------------------------------------------------------- | ---------------------- |
| `AVATAR_COLORS`          | `['#3B82F6','#EF4444','#10B981','#F59E0B','#8B5CF6','#EC4899','#06B6D4','#F97316']` | ã‚¢ãƒã‚¿ãƒ¼è‰²ï¼ˆ8è‰²ï¼‰      |
| `MESSAGE_MAX_LENGTH`     | `2000`                                                                              | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æœ€å¤§æ–‡å­—æ•°   |
| `IMAGE_MAX_SIZE_MB`      | `10`                                                                                | ç”»åƒæœ€å¤§MB             |
| `IMAGE_MAX_SIZE_BYTES`   | `10485760`                                                                          | ç”»åƒæœ€å¤§ãƒã‚¤ãƒˆ         |
| `ALLOWED_IMAGE_TYPES`    | `['image/jpeg','image/png','image/gif','image/webp']`                               | è¨±å¯ç”»åƒMIME           |
| `MESSAGES_PER_PAGE`      | `50`                                                                                | ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æ•°     |
| `CONVERSATIONS_PER_PAGE` | `50`                                                                                | ä¼šè©±ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³æ•° |
| `SOUND_SEND`             | `'/sounds/send.wav'`                                                                | é€ä¿¡éŸ³ãƒ‘ã‚¹             |
| `SOUND_RECEIVE`          | `'/sounds/receive.wav'`                                                             | å—ä¿¡éŸ³ãƒ‘ã‚¹             |
| `REACTION_EMOJIS`        | `['ğŸ‘','âœ…']`                                                                       | ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³çµµæ–‡å­—     |
| `DATE_TIMEZONE`          | `'Asia/Tokyo'`                                                                      | ã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³           |
| `FRIEND_CODE_LENGTH`     | `8`                                                                                 | ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰é•·       |
| `MESSAGE_IMAGES_BUCKET`  | `'message-images'`                                                                  | ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ãƒã‚±ãƒƒãƒˆå   |

### 20.10 å…¬é–‹APIé–¢æ•°

#### èªè¨¼APIï¼ˆapi/auth.tsï¼‰

| é–¢æ•°             | å¼•æ•°                    | æˆ»ã‚Šå€¤                 | èª¬æ˜                                |
| ---------------- | ----------------------- | ---------------------- | ----------------------------------- |
| `signUp`         | `SignUpFormData`        | `{ profile: Profile }` | ç™»éŒ²ï¼‹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—ï¼ˆ500mså¾…æ©Ÿï¼‰ |
| `login`          | `email, password`       | `{ profile: Profile }` | ãƒ­ã‚°ã‚¤ãƒ³ï¼‹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—          |
| `logout`         | -                       | `void`                 | ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ                          |
| `getCurrentUser` | -                       | `Profile \| null`      | ç¾åœ¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—      |
| `getProfile`     | `userId`                | `Profile \| null`      | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—                    |
| `updateProfile`  | `userId, ProfileUpdate` | `Profile`              | ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ›´æ–°                    |

#### ãƒ•ãƒ¬ãƒ³ãƒ‰APIï¼ˆapi/friends.tsï¼‰

| é–¢æ•°                     | å¼•æ•°                 | æˆ»ã‚Šå€¤            | èª¬æ˜                               |
| ------------------------ | -------------------- | ----------------- | ---------------------------------- |
| `getFriends`             | `userId`             | `Profile[]`       | ãƒ•ãƒ¬ãƒ³ãƒ‰ä¸€è¦§ï¼ˆoræ¡ä»¶ã§åŒæ–¹å‘å–å¾—ï¼‰ |
| `addFriendByCode`        | `userId, friendCode` | `Profile`         | ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã§è¿½åŠ ï¼ˆåŒæ–¹å‘ä½œæˆï¼‰ |
| `getProfileByFriendCode` | `friendCode`         | `Profile \| null` | ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æ¤œç´¢ |
| `removeFriend`           | `userId, friendId`   | `void`            | ãƒ•ãƒ¬ãƒ³ãƒ‰å‰Šé™¤ï¼ˆåŒæ–¹å‘å‰Šé™¤ï¼‰         |

**addFriendByCodeã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³**:

1. ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰å­˜åœ¨ç¢ºèª â†’ Error: `"ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“"`
2. è‡ªåˆ†è‡ªèº«ãƒã‚§ãƒƒã‚¯ â†’ Error: `"è‡ªåˆ†è‡ªèº«ã‚’ãƒ•ãƒ¬ãƒ³ãƒ‰ã«è¿½åŠ ã§ãã¾ã›ã‚“"`
3. æ—¢å­˜ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒã‚§ãƒƒã‚¯ â†’ Error: `"æ—¢ã«ãƒ•ãƒ¬ãƒ³ãƒ‰ã§ã™"`
4. åŒæ–¹å‘ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚·ãƒƒãƒ—ä½œæˆï¼ˆ2ãƒ¬ã‚³ãƒ¼ãƒ‰: `userIdâ†’friendId` + `friendIdâ†’userId`ï¼‰

#### ä¼šè©±APIï¼ˆapi/conversations.tsï¼‰

| é–¢æ•°                       | å¼•æ•°                                           | æˆ»ã‚Šå€¤                      | èª¬æ˜                         |
| -------------------------- | ---------------------------------------------- | --------------------------- | ---------------------------- |
| `getConversations`         | `userId`                                       | `ConversationWithDetails[]` | ä¼šè©±ä¸€è¦§ï¼ˆupdated_at DESCï¼‰  |
| `getConversation`          | `conversationId`                               | `Conversation \| null`      | ä¼šè©±è©³ç´°å–å¾—                 |
| `createDirectConversation` | `userId, friendId`                             | `Conversation`              | DMä½œæˆï¼ˆæ—¢å­˜ã‚ã‚Œã°è¿”å´ï¼‰     |
| `createGroupConversation`  | `userId, name, iconText, iconColor, memberIds` | `Conversation`              | ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆï¼‹æ‹›å¾…ã‚³ãƒ¼ãƒ‰ç”Ÿæˆ |
| `joinGroupByInviteCode`    | `userId, inviteCode`                           | `Conversation`              | æ‹›å¾…ã‚³ãƒ¼ãƒ‰ã§ã‚°ãƒ«ãƒ¼ãƒ—å‚åŠ      |
| `leaveConversation`        | `userId, conversationId`                       | `void`                      | ä¼šè©±ã‹ã‚‰é€€å‡º                 |
| `updateGroup`              | `conversationId, updates`                      | `Conversation`              | ã‚°ãƒ«ãƒ¼ãƒ—æƒ…å ±æ›´æ–°             |

**getConversationsã®å‡¦ç†**:

1. `conversation_members`ã‹ã‚‰è‡ªåˆ†ã®ä¼šè©±IDå–å¾—
2. `conversations`ã‚’`updated_at DESC`ã§å–å¾—ï¼ˆlimit 50ï¼‰
3. ãƒ¡ãƒ³ãƒãƒ¼ï¼‹ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚’JOINå–å¾—
4. å„ä¼šè©±ã«å¯¾ã—ã¦æœ€æ–°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ»æœªèª­æ•°ã‚’è¨ˆç®—

**æœªèª­æ•°ã®è¨ˆç®—**: `messages WHERE created_at > last_read_at AND sender_id != userId` ã®COUNT

#### ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸APIï¼ˆapi/messages.tsï¼‰

| é–¢æ•°            | å¼•æ•°                                                        | æˆ»ã‚Šå€¤                 | èª¬æ˜                                                            |
| --------------- | ----------------------------------------------------------- | ---------------------- | --------------------------------------------------------------- |
| `getMessages`   | `conversationId, cursor?`                                   | `MessageWithDetails[]` | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å–å¾—ï¼ˆã‚«ãƒ¼ã‚½ãƒ«ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ï¼‰                      |
| `sendMessage`   | `conversationId, senderId, content?, imageUrl?, replyToId?` | `Message`              | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡ï¼‹updated_atæ›´æ–°                                  |
| `deleteMessage` | `messageId`                                                 | `void`                 | ã‚½ãƒ•ãƒˆãƒ‡ãƒªãƒ¼ãƒˆï¼ˆis_deleted=true, content=null, image_url=nullï¼‰ |
| `markAsRead`    | `conversationId, userId`                                    | `void`                 | last_read_atã‚’ç¾åœ¨æ™‚åˆ»ã«æ›´æ–°                                    |

**getMessagesã®å‡¦ç†**:

1. `messages`ã«sender(profiles)ã¨reactions(message_reactions+profiles)ã‚’JOIN
2. `created_at DESC`ã§å–å¾—ã€limit 50
3. cursoræŒ‡å®šæ™‚ã¯`created_at < cursor`ã§ãƒ•ã‚£ãƒ«ã‚¿
4. `reply_to_id`ãŒå­˜åœ¨ã™ã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®è¿”ä¿¡å…ˆã‚’åˆ¥ã‚¯ã‚¨ãƒªã§å–å¾—ï¼ˆPostgREST self-referencing FKéå¯¾å¿œã®ãŸã‚ï¼‰
5. çµæœã‚’æ˜‡é †ï¼ˆæ™‚ç³»åˆ—ï¼‰ã«ä¸¦ã¹æ›¿ãˆã¦è¿”ã™

#### ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³APIï¼ˆapi/reactions.tsï¼‰

| é–¢æ•°             | å¼•æ•°                       | æˆ»ã‚Šå€¤            | èª¬æ˜             |
| ---------------- | -------------------------- | ----------------- | ---------------- |
| `addReaction`    | `messageId, userId, emoji` | `MessageReaction` | ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³è¿½åŠ  |
| `removeReaction` | `messageId, userId, emoji` | `void`            | ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³å‰Šé™¤ |

#### ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸APIï¼ˆapi/storage.tsï¼‰

| é–¢æ•°          | å¼•æ•°           | æˆ»ã‚Šå€¤   | èª¬æ˜                          |
| ------------- | -------------- | -------- | ----------------------------- |
| `uploadImage` | `file, userId` | `string` | ç”»åƒã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ã€å…¬é–‹URLè¿”å´ |

**ãƒ‘ã‚¹**: `{userId}/{timestamp}.{ext}` â†’ `message-images`ãƒã‚±ãƒƒãƒˆ

### 20.11 å†…éƒ¨ãƒ•ãƒƒã‚¯ï¼ˆéå…¬é–‹ï¼‰

#### useAuth

**çŠ¶æ…‹**: `user`, `isLoading`, `isAuthenticated`, `error`
**ãƒ¡ã‚½ãƒƒãƒ‰**: `signUp`, `login`, `logout`, `updateProfile`, `clearError`

**åˆæœŸåŒ–å‡¦ç†**:

1. `supabase.auth.getUser()`ã§ç¾åœ¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ç¢ºèª
2. `supabase.auth.onAuthStateChange()`ã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ç›£è¦–
3. `SIGNED_IN` â†’ profilesãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰å–å¾—
4. `SIGNED_OUT` â†’ user = null

**signUpå‡¦ç†**:

1. `supabase.auth.signUp()` â†’ 1000mså¾…æ©Ÿï¼ˆãƒˆãƒªã‚¬ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ä½œæˆå¾…ã¡ï¼‰
2. avatarColoræŒ‡å®šæ™‚ â†’ profilesãƒ†ãƒ¼ãƒ–ãƒ«æ›´æ–°
3. ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«å–å¾—ã—ã¦çŠ¶æ…‹æ›´æ–°

#### useConversations

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: `userId: string | null`
**çŠ¶æ…‹**: `conversations`, `isLoading`, `error`
**ãƒ¡ã‚½ãƒƒãƒ‰**: `refresh`

**Realtimeãƒãƒ£ãƒãƒ«**: `'conversations-realtime'`

- INSERT on messages â†’ ä¸€è¦§å†å–å¾—
- UPDATE on conversations â†’ ä¸€è¦§å†å–å¾—

#### useMessages

**ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿**: `conversationId: string | null, userId: string | null`
**çŠ¶æ…‹**: `messages`, `isLoading`, `error`, `hasMore`
**ãƒ¡ã‚½ãƒƒãƒ‰**: `loadMore`, `send`

**Realtimeãƒãƒ£ãƒãƒ«**: `'messages-${conversationId}'`

- INSERT on messages â†’ `buildRealtimeMsg()`ã§MessageWithDetailsæ§‹ç¯‰ â†’ è¿½åŠ  â†’ ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ãªã‚‰`markAsRead`
- UPDATE on messages â†’ `applyMsgUpdate()`ã§æ›´æ–°
- ANY on message_reactions â†’ å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†å–å¾—

**ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³**: æœ€å¤ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®`created_at`ã‚’cursorã¨ã—ã¦ä½¿ç”¨ã€‚`hasMore = messages.length >= MESSAGES_PER_PAGE`

### 20.12 å†…éƒ¨ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆéå…¬é–‹ï¼‰

#### AuthProviderï¼ˆå…¬é–‹ä¾‹å¤–ï¼‰

`useAuth`ãƒ•ãƒƒã‚¯ã‹ã‚‰èªè¨¼çŠ¶æ…‹ã‚’å–å¾—ã—ã€`AuthContext.Provider`ã§wrapã€‚
`useAuthContext()`ã§ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå–å¾—ï¼ˆProviderå¤–ã§ã¯ Error throwï¼‰ã€‚

#### ProfileAvatar

**Props**: `text: string, color: string, size?: 'sm' | 'md' | 'lg'`

| ã‚µã‚¤ã‚º | ã‚¯ãƒ©ã‚¹              |
| ------ | ------------------- |
| `sm`   | `w-8 h-8 text-xs`   |
| `md`   | `w-10 h-10 text-sm` |
| `lg`   | `w-16 h-16 text-xl` |

### 20.13 æ—¥ä»˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£

å…¨ã¦Asia/Tokyoã‚¿ã‚¤ãƒ ã‚¾ãƒ¼ãƒ³å›ºå®šã€‚

| é–¢æ•°                     | ç”¨é€”                     | å‡ºåŠ›ä¾‹                                           |
| ------------------------ | ------------------------ | ------------------------------------------------ |
| `formatMessageTime`      | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ™‚åˆ»ï¼ˆHH:MMï¼‰  | `"14:30"`                                        |
| `formatDateSeparator`    | æ—¥ä»˜ã‚»ãƒ‘ãƒ¬ãƒ¼ã‚¿           | `"2026å¹´2æœˆ13æ—¥(æœ¨)"`                            |
| `formatConversationTime` | ä¼šè©±ä¸€è¦§æ™‚åˆ»ï¼ˆç›¸å¯¾è¡¨ç¤ºï¼‰ | ä»Šæ—¥â†’`"14:30"`, æ˜¨æ—¥â†’`"æ˜¨æ—¥"`, ãã‚Œä»¥å‰â†’`"2/13"` |
| `isSameDay`              | åŒæ—¥åˆ¤å®š                 | `true / false`                                   |

### 20.14 ãƒšãƒ¼ã‚¸æ§‹æˆ

#### 20.14.1 ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆï¼ˆ`src/app/m/layout.tsx`ï¼‰

```
AuthProvider
  â””â”€â”€ MessengerLayoutInner
      â”œâ”€â”€ Global Realtime Subscriptionï¼ˆé€šçŸ¥ãƒ»ãƒãƒƒã‚¸ï¼‰
      â”œâ”€â”€ Auth Guardï¼ˆéå…¬é–‹ãƒšãƒ¼ã‚¸ã§ã®èªè¨¼ãƒã‚§ãƒƒã‚¯ï¼‰
      â”œâ”€â”€ Childrenï¼ˆå„ãƒšãƒ¼ã‚¸ï¼‰
      â””â”€â”€ BottomNavigationï¼ˆæ¡ä»¶ä»˜ãè¡¨ç¤ºï¼‰
```

**å…¬é–‹ãƒ‘ã‚¹**ï¼ˆèªè¨¼ä¸è¦ï¼‰: `/m/login`, `/m/signup`, `/m/add/*`, `/m/group/invite/*`
**BottomNavéè¡¨ç¤º**: ãƒ­ã‚°ã‚¤ãƒ³ãƒ»ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ãƒ»ãƒãƒ£ãƒƒãƒˆãƒšãƒ¼ã‚¸

**BottomNavigation ã‚¿ãƒ–**:

| ãƒ‘ã‚¹         | ãƒ©ãƒ™ãƒ«   | ã‚¢ã‚¤ã‚³ãƒ³ | ãƒãƒƒãƒãƒ³ã‚° |
| ------------ | -------- | -------- | ---------- |
| `/m`         | ãƒˆãƒ¼ã‚¯   | ğŸ—¨ï¸       | exact      |
| `/m/friends` | ãƒ•ãƒ¬ãƒ³ãƒ‰ | ğŸ‘¥       | prefix     |
| `/m/profile` | ãƒã‚¤     | ğŸ‘¤       | prefix     |

**ã‚°ãƒ­ãƒ¼ãƒãƒ«é€šçŸ¥ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³**:

- ãƒãƒ£ãƒãƒ«: `'global-notifications'`
- INSERT on messages â†’ `refreshAndNotify()` â†’ ãƒãƒƒã‚¸æ›´æ–° + ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥
- UPDATE on conversations â†’ `refreshAndNotify()` â†’ ãƒãƒƒã‚¸æ›´æ–°
- ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥: `new Notification(senderName, { body, icon: '/icon-192.png', tag: 'messenger-message' })`
- PWAãƒãƒƒã‚¸: `navigator.setAppBadge(totalUnread)` / `navigator.clearAppBadge()`

#### 20.14.2 ãƒˆãƒ¼ã‚¯ä¸€è¦§ï¼ˆ`src/app/m/page.tsx`ï¼‰

**ãƒ«ãƒ¼ãƒˆ**: `/m`

**UIæ§‹æˆ**:

1. **ãƒ˜ãƒƒãƒ€ãƒ¼**: ã‚¿ã‚¤ãƒˆãƒ«ã€Œãƒˆãƒ¼ã‚¯ã€+ æ¤œç´¢ã‚¢ã‚¤ã‚³ãƒ³ + æ–°è¦ãƒãƒ£ãƒƒãƒˆãƒœã‚¿ãƒ³
2. **é€šçŸ¥ãƒãƒŠãƒ¼**: é€šçŸ¥è¨±å¯çŠ¶æ…‹ã«å¿œã˜ã¦è¡¨ç¤º
   - `'default'` â†’ ã€Œé€šçŸ¥ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã‹ï¼Ÿã€+ è¨±å¯ãƒœã‚¿ãƒ³
   - `'denied'` â†’ ãƒ–ãƒ­ãƒƒã‚¯è§£é™¤æ‰‹é †ï¼ˆiPhone/PCï¼‰
3. **ä¼šè©±ãƒªã‚¹ãƒˆ**: `ConversationItem`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
   - ã‚¢ãƒã‚¿ãƒ¼ï¼ˆè‰²+ãƒ†ã‚­ã‚¹ãƒˆ2æ–‡å­—ï¼‰
   - è¡¨ç¤ºåï¼ˆDM: ç›¸æ‰‹å, ã‚°ãƒ«ãƒ¼ãƒ—: ã‚°ãƒ«ãƒ¼ãƒ—åï¼‰
   - æœ€çµ‚ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆå‰Šé™¤æ¸ˆã¿â†’ã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒå‰Šé™¤ã•ã‚Œã¾ã—ãŸã€, ç”»åƒâ†’ã€ŒğŸ“· ç”»åƒã€ï¼‰
   - ç›¸å¯¾æ™‚åˆ»ï¼ˆä»Šæ—¥: HH:MM, æ˜¨æ—¥, M/Dï¼‰
   - æœªèª­ãƒãƒƒã‚¸ï¼ˆé’, æœ€å¤§99+ï¼‰
4. **æ–°è¦ãƒãƒ£ãƒƒãƒˆãƒ¢ãƒ¼ãƒ€ãƒ«**: ãƒ•ãƒ¬ãƒ³ãƒ‰é¸æŠ + ã€Œã‚°ãƒ«ãƒ¼ãƒ—ã‚’ä½œæˆã€ãƒœã‚¿ãƒ³

**Realtime**: `'talk-list-refresh'`ãƒãƒ£ãƒãƒ«ã§ä¼šè©±ä¸€è¦§ã®è‡ªå‹•æ›´æ–°

#### 20.14.3 ãƒ­ã‚°ã‚¤ãƒ³ï¼ˆ`src/app/m/login/page.tsx`ï¼‰

**ãƒ«ãƒ¼ãƒˆ**: `/m/login`

**UI**: ã‚°ãƒ©ãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³èƒŒæ™¯ï¼ˆblue-500â†’blue-700ï¼‰ã€ãƒ•ã‚©ãƒ¼ãƒ ã‚«ãƒ¼ãƒ‰ã€email/passwordå…¥åŠ›ã€ã‚¨ãƒ©ãƒ¼è¡¨ç¤º
**å‡¦ç†**: `login()` â†’ æˆåŠŸæ™‚ `/m` ã¸é·ç§»

#### 20.14.4 ã‚µã‚¤ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆ`src/app/m/signup/page.tsx`ï¼‰

**ãƒ«ãƒ¼ãƒˆ**: `/m/signup`

**2æ®µéšãƒ•ã‚©ãƒ¼ãƒ **:

1. **èªè¨¼æƒ…å ±**: email + password
2. **ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«**: display_nameï¼ˆmax 20æ–‡å­—ï¼‰+ ã‚¢ãƒã‚¿ãƒ¼è‰²é¸æŠï¼ˆAVATAR_COLORSï¼‰+ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼

**å‡¦ç†**: `signUp()` â†’ æˆåŠŸæ™‚ `/m` ã¸é·ç§»

#### 20.14.5 ãƒãƒ£ãƒƒãƒˆï¼ˆ`src/app/m/chat/[conversationId]/page.tsx`ï¼‰

**ãƒ«ãƒ¼ãƒˆ**: `/m/chat/{conversationId}`

**UIæ§‹æˆ**:

1. **ãƒ˜ãƒƒãƒ€ãƒ¼**: æˆ»ã‚‹ãƒœã‚¿ãƒ³ + ä¼šè©±å + è¨­å®šã‚¢ã‚¤ã‚³ãƒ³ï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ã®ã¿ï¼‰
2. **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¨ãƒªã‚¢**: ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å¯èƒ½ã€ä¸Šéƒ¨ã«ã€Œã‚‚ã£ã¨èª­ã‚€ã€ãƒœã‚¿ãƒ³
3. **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒãƒ–ãƒ«**: `MessageBubble`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
   - é€ä¿¡è€…ã‚¢ãƒã‚¿ãƒ¼ï¼ˆå·¦ï¼‰ã€é€ä¿¡è€…åï¼ˆã‚°ãƒ«ãƒ¼ãƒ—ã®ã¿ï¼‰ã€æœ¬æ–‡ã€æ™‚åˆ»ã€ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³
   - è¿”ä¿¡å…ˆãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆé’ãƒœãƒ¼ãƒ€ãƒ¼ã€å¼•ç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼‰
   - ç”»åƒè¡¨ç¤ºï¼ˆã‚¿ãƒƒãƒ—ã§ãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼‰
   - ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆé•·æŠ¼ã—500ms or å³ã‚¯ãƒªãƒƒã‚¯ï¼‰
4. **è¿”ä¿¡ãƒãƒ¼**: è¿”ä¿¡æ™‚ã«ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¥åŠ›ä¸Šéƒ¨ã«è¡¨ç¤º
5. **å…¥åŠ›ãƒãƒ¼**: ç”»åƒãƒœã‚¿ãƒ³ + textarea + é€ä¿¡ãƒœã‚¿ãƒ³

**ã‚«ãƒ©ãƒ¼ãƒ‘ãƒ¬ãƒƒãƒˆ**:

- ãƒãƒ£ãƒƒãƒˆèƒŒæ™¯: `bg-[#8CABD9]`
- é€ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: `bg-[#A8D97A]`ï¼ˆå³å¯„ã›ï¼‰
- å—ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸: `bg-white`ï¼ˆå·¦å¯„ã›ï¼‰

**ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ¡ãƒ‹ãƒ¥ãƒ¼**: ãƒªã‚¢ã‚¯ã‚·ãƒ§ãƒ³é¸æŠ + è¿”ä¿¡ + å‰Šé™¤ï¼ˆè‡ªåˆ†ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã¿ï¼‰

**ã‚µã‚¦ãƒ³ãƒ‰**: é€ä¿¡æ™‚`send.wav`ã€å—ä¿¡æ™‚`receive.wav`

**Realtime**: `'messages-${conversationId}'`ãƒãƒ£ãƒãƒ«

- INSERT â†’ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿½åŠ  + ã‚µã‚¦ãƒ³ãƒ‰ + æ—¢èª­ãƒãƒ¼ã‚¯
- UPDATE â†’ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹æ›´æ–°
- message_reactions ANY â†’ å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†å–å¾—

#### 20.14.6 ã‚°ãƒ«ãƒ¼ãƒ—è¨­å®šï¼ˆ`src/app/m/chat/[conversationId]/settings/page.tsx`ï¼‰

**ãƒ«ãƒ¼ãƒˆ**: `/m/chat/{conversationId}/settings`

**ã‚»ã‚¯ã‚·ãƒ§ãƒ³**:

1. ã‚°ãƒ«ãƒ¼ãƒ—ã‚¢ã‚¤ã‚³ãƒ³ + ã‚°ãƒ«ãƒ¼ãƒ—å
2. æ‹›å¾…ãƒªãƒ³ã‚¯ï¼ˆã‚³ãƒ”ãƒ¼æ©Ÿèƒ½ä»˜ãï¼‰
3. ãƒ¡ãƒ³ãƒãƒ¼ä¸€è¦§ï¼ˆè¿½åŠ ãƒœã‚¿ãƒ³ä»˜ãï¼‰
4. ãƒ¡ãƒ³ãƒãƒ¼è¿½åŠ ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒ•ãƒ¬ãƒ³ãƒ‰ã‹ã‚‰é¸æŠã€æ—¢å­˜ãƒ¡ãƒ³ãƒãƒ¼é™¤å¤–ï¼‰
5. ã‚°ãƒ«ãƒ¼ãƒ—é€€å‡ºãƒœã‚¿ãƒ³ï¼ˆç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ä»˜ãï¼‰

#### 20.14.7 ãƒ•ãƒ¬ãƒ³ãƒ‰ä¸€è¦§ï¼ˆ`src/app/m/friends/page.tsx`ï¼‰

**ãƒ«ãƒ¼ãƒˆ**: `/m/friends`

**UI**: ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªã‚¹ãƒˆï¼ˆã‚¢ãƒã‚¿ãƒ¼ + åå‰ + ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚¢ã‚¤ã‚³ãƒ³ï¼‰
**æ“ä½œ**: ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚¿ãƒƒãƒ— â†’ `createDirectConversation()` â†’ ãƒãƒ£ãƒƒãƒˆã¸é·ç§»

#### 20.14.8 ãƒ•ãƒ¬ãƒ³ãƒ‰è¿½åŠ ï¼ˆ`src/app/m/friends/add/page.tsx`ï¼‰

**ãƒ«ãƒ¼ãƒˆ**: `/m/friends/add`

**2ã‚»ã‚¯ã‚·ãƒ§ãƒ³**:

1. **ãƒã‚¤QRã‚³ãƒ¼ãƒ‰**: QRã‚³ãƒ¼ãƒ‰ï¼ˆ180x180, level Mï¼‰+ ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ + ã‚³ãƒ”ãƒ¼ãƒœã‚¿ãƒ³
   - QRã‚³ãƒ¼ãƒ‰URL: `${origin}/m/add/{friend_code}`
2. **ã‚³ãƒ¼ãƒ‰ã§è¿½åŠ **: å…¥åŠ›ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆmax 20æ–‡å­—ï¼‰+ è¿½åŠ ãƒœã‚¿ãƒ³

#### 20.14.9 ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ï¼ˆ`src/app/m/profile/page.tsx`ï¼‰

**ãƒ«ãƒ¼ãƒˆ**: `/m/profile`

**è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰**: ã‚¢ãƒã‚¿ãƒ¼ + åå‰ + ãƒ•ãƒ¬ãƒ³ãƒ‰ã‚³ãƒ¼ãƒ‰ + ç·¨é›†ãƒœã‚¿ãƒ³ + é€šçŸ¥ãƒˆã‚°ãƒ« + ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ
**ç·¨é›†ãƒ¢ãƒ¼ãƒ‰**: åå‰å…¥åŠ›ï¼ˆmax 20ï¼‰+ è‰²é¸æŠï¼ˆAVATAR_COLORSï¼‰+ ä¿å­˜/ã‚­ãƒ£ãƒ³ã‚»ãƒ«
**ç®¡ç†è€…ãƒ‘ãƒãƒ«ãƒªãƒ³ã‚¯**: `is_admin = true`ã®å ´åˆã®ã¿è¡¨ç¤º

**é€šçŸ¥ãƒˆã‚°ãƒ«**: `NotificationToggle`ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆiOS PWAå¯¾å¿œã‚¬ã‚¤ãƒ‰ä»˜ãï¼‰

#### 20.14.10 ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ¤œç´¢ï¼ˆ`src/app/m/search/page.tsx`ï¼‰

**ãƒ«ãƒ¼ãƒˆ**: `/m/search`

**æ¤œç´¢ãƒ•ãƒ­ãƒ¼**:

1. æ¤œç´¢å…¥åŠ›ï¼ˆè‡ªå‹•ãƒ•ã‚©ãƒ¼ã‚«ã‚¹ï¼‰
2. 300msãƒ‡ãƒã‚¦ãƒ³ã‚¹
3. 2æ–‡å­—ä»¥ä¸Šã§æ¤œç´¢å®Ÿè¡Œ
4. `messages`ãƒ†ãƒ¼ãƒ–ãƒ«ã®`content`ã‚’ilikeæ¤œç´¢ï¼ˆæœ€å¤§50ä»¶ï¼‰
5. çµæœã«ãƒã‚¤ãƒ©ã‚¤ãƒˆè¡¨ç¤º

#### 20.14.11 ç®¡ç†ãƒ‘ãƒãƒ«ï¼ˆ`src/app/m/admin/page.tsx`ï¼‰

**ãƒ«ãƒ¼ãƒˆ**: `/m/admin`ï¼ˆ`is_admin = true`ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ï¼‰

**ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰**:

- çµ±è¨ˆã‚«ãƒ¼ãƒ‰: ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ãƒ»ä¼šè©±æ•°ãƒ»ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸æ•°
- ä¼šè©±ãƒªã‚¹ãƒˆ: ã‚¿ã‚¤ãƒ—ãƒ•ã‚£ãƒ«ã‚¿ï¼ˆGroup/DMï¼‰ã€ãƒ¡ãƒ³ãƒãƒ¼æ•°è¡¨ç¤º
- ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãƒ‘ãƒãƒ«: é¸æŠã—ãŸä¼šè©±ã®å…¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã€å‰Šé™¤æ©Ÿèƒ½

#### 20.14.12 ã‚°ãƒ«ãƒ¼ãƒ—ä½œæˆï¼ˆ`src/app/m/group/create/page.tsx`ï¼‰

**ãƒ«ãƒ¼ãƒˆ**: `/m/group/create`

**ãƒ•ã‚©ãƒ¼ãƒ **: ã‚°ãƒ«ãƒ¼ãƒ—åï¼ˆrequired, max 30ï¼‰+ ã‚¢ã‚¤ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼ˆ1-2æ–‡å­—, auto: name.slice(0,2)ï¼‰+ è‰²é¸æŠ + ãƒ•ãƒ¬ãƒ³ãƒ‰é¸æŠï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ï¼‰
**å‡¦ç†**: `createGroupConversation()` â†’ ãƒãƒ£ãƒƒãƒˆã¸é·ç§»

#### 20.14.13 ã‚°ãƒ«ãƒ¼ãƒ—æ‹›å¾…ï¼ˆ`src/app/m/group/invite/[code]/page.tsx`ï¼‰

**ãƒ«ãƒ¼ãƒˆ**: `/m/group/invite/{code}`ï¼ˆèªè¨¼ä¸è¦ï¼‰

**çŠ¶æ…‹**: loading â†’ not-found / error / loaded
**loadedæ™‚ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³**: æœªãƒ­ã‚°ã‚¤ãƒ³â†’ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯ã€æ—¢ã«ãƒ¡ãƒ³ãƒãƒ¼â†’ãƒãƒ£ãƒƒãƒˆãƒªãƒ³ã‚¯ã€å‚åŠ å¯èƒ½â†’å‚åŠ ãƒœã‚¿ãƒ³

#### 20.14.14 URLçµŒç”±ãƒ•ãƒ¬ãƒ³ãƒ‰è¿½åŠ ï¼ˆ`src/app/m/add/[friendCode]/page.tsx`ï¼‰

**ãƒ«ãƒ¼ãƒˆ**: `/m/add/{friendCode}`ï¼ˆèªè¨¼ä¸è¦ï¼‰

**UI**: ã‚¿ãƒ¼ã‚²ãƒƒãƒˆãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«ã‚«ãƒ¼ãƒ‰ + è¿½åŠ ãƒœã‚¿ãƒ³
**ãƒã‚§ãƒƒã‚¯**: æœªãƒ­ã‚°ã‚¤ãƒ³â†’ãƒ­ã‚°ã‚¤ãƒ³ãƒªãƒ³ã‚¯ã€è‡ªåˆ†è‡ªèº«â†’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¡¨ç¤ºã€è¿½åŠ æ¸ˆã¿â†’æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ï¼ˆ1.5ç§’å¾Œã«ãƒ•ãƒ¬ãƒ³ãƒ‰ä¸€è¦§ã¸é·ç§»ï¼‰

### 20.15 é€šçŸ¥ã‚·ã‚¹ãƒ†ãƒ 

#### ãƒ–ãƒ©ã‚¦ã‚¶é€šçŸ¥

```typescript
function showBrowserNotification(title: string, body: string): void {
  if (typeof Notification === 'undefined' || Notification.permission !== 'granted') return
  const notification = new Notification(title, {
    body,
    icon: '/icon-192.png',
    tag: 'messenger-message',
  })
  notification.onclick = () => {
    window.focus()
    notification.close()
  }
}
```

**ç™ºç«æ¡ä»¶**: ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸INSERTï¼ˆè‡ªåˆ†ã®é€ä¿¡ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯é™¤å¤–ï¼‰
**ã‚¿ã‚¤ãƒˆãƒ«**: é€ä¿¡è€…åï¼ˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã•ã‚ŒãŸä¼šè©±ãƒ‡ãƒ¼ã‚¿ã‹ã‚‰æ¤œç´¢ï¼‰
**æœ¬æ–‡**: ç”»åƒâ†’ã€ŒğŸ“· ç”»åƒã€ã€ãƒ†ã‚­ã‚¹ãƒˆâ†’ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å†…å®¹

#### PWAãƒãƒƒã‚¸

```typescript
function updateAppBadge(count: number): void {
  if (!('setAppBadge' in navigator)) return
  if (count > 0) {
    void (navigator as Navigator & { setAppBadge: (n: number) => Promise<void> }).setAppBadge(count)
  } else {
    void (navigator as Navigator & { clearAppBadge: () => Promise<void> }).clearAppBadge()
  }
}
```

**æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°**: ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸INSERTæ™‚ãƒ»ä¼šè©±UPDATEæ™‚ã«å…¨æœªèª­æ•°ã‚’å†è¨ˆç®—

#### é€šçŸ¥æ¨©é™ãƒãƒŠãƒ¼

| çŠ¶æ…‹            | è¡¨ç¤º                                                        |
| --------------- | ----------------------------------------------------------- |
| `'default'`     | é’ãƒãƒŠãƒ¼: ã€Œé€šçŸ¥ã‚’æœ‰åŠ¹ã«ã—ã¾ã™ã‹ï¼Ÿã€+ è¨±å¯ãƒœã‚¿ãƒ³            |
| `'denied'`      | ç¥ç€ãƒãƒŠãƒ¼: ãƒ–ãƒ­ãƒƒã‚¯è§£é™¤æ‰‹é †ï¼ˆiPhoneè¨­å®š / PCãƒ–ãƒ©ã‚¦ã‚¶è¨­å®šï¼‰ |
| `'granted'`     | éè¡¨ç¤º                                                      |
| `'unsupported'` | éè¡¨ç¤º                                                      |

#### iOS PWAåˆ¶é™äº‹é …

- HTTPSå¿…é ˆï¼ˆé–‹ç™ºç’°å¢ƒHTTPä¸å¯ï¼‰
- iOS 16.4+
- ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€çµŒç”±ã§ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¿…é ˆ
- é€šçŸ¥è¨­å®šã¯iOSè¨­å®šã‚¢ãƒ—ãƒªã‹ã‚‰å¤‰æ›´

### 20.16 ã‚µã‚¦ãƒ³ãƒ‰ã‚¨ãƒ•ã‚§ã‚¯ãƒˆ

| ãƒ•ã‚¡ã‚¤ãƒ«              | ç”¨é€”             | å†ç”Ÿã‚¿ã‚¤ãƒŸãƒ³ã‚°                   |
| --------------------- | ---------------- | -------------------------------- |
| `/sounds/send.wav`    | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸é€ä¿¡éŸ³ | `sendMessage()`æˆåŠŸæ™‚            |
| `/sounds/receive.wav` | ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡éŸ³ | ä»–ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡æ™‚ |

å†ç”Ÿæ–¹æ³•: `new Audio(path).play()` ï¼ˆå¤±æ•—æ™‚ã¯ã‚µã‚¤ãƒ¬ãƒ³ãƒˆï¼‰

### 20.17 ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ä¸€è¦§

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³       | åå‰                               | æ¦‚è¦                                                         |
| ---------------- | ---------------------------------- | ------------------------------------------------------------ |
| `20260213144729` | `create_profiles_table`            | profilesãƒ†ãƒ¼ãƒ–ãƒ«ï¼‹RLSï¼‹é–¢æ•°ï¼‹ãƒˆãƒªã‚¬ãƒ¼                        |
| `20260213144739` | `create_friendships_table`         | friendshipsãƒ†ãƒ¼ãƒ–ãƒ«ï¼‹RLS                                     |
| `20260213144813` | `create_conversations_and_members` | conversationsï¼‹conversation_membersï¼‹RLS                     |
| `20260213144826` | `create_messages_table`            | messagesãƒ†ãƒ¼ãƒ–ãƒ«ï¼‹RLSï¼‹Realtime                              |
| `20260213144836` | `create_message_reactions_table`   | message_reactionsãƒ†ãƒ¼ãƒ–ãƒ«ï¼‹RLSï¼‹Realtime                     |
| `20260213165421` | `fix_function_search_path`         | å…¨é–¢æ•°ã«SET search_path = ''è¿½åŠ                              |
| `20260213171820` | `fix_rls_policies`                 | friendships INSERTåŒæ–¹å‘åŒ–ï¼‹RLSãƒã‚°ä¿®æ­£                      |
| `20260213172513` | `fix_rls_infinite_recursion`       | `is_conversation_member()`é–¢æ•°å°å…¥ï¼‹RLSå†å¸°ä¿®æ­£              |
| `20260213172529` | `optimize_messages_rls_policies`   | messages/reactions RLSã‚’`is_conversation_member`ä½¿ç”¨ã«æœ€é©åŒ– |
| `20260213172922` | `fix_conversation_members_select`  | `user_conversation_ids()`é–¢æ•°å°å…¥ï¼‹ãƒ¡ãƒ³ãƒãƒ¼SELECTä¿®æ­£        |
| `20260213173344` | `add_conversations_to_realtime`    | conversationsï¼‹conversation_membersã‚’Realtimeè¿½åŠ             |

### 20.18 RLSè¨­è¨ˆã®æ³¨æ„ç‚¹

PostgRESTã«ãŠã‘ã‚‹RLSãƒãƒªã‚·ãƒ¼ã®å†å¸°å•é¡Œã‚’è§£æ±ºã™ã‚‹ãŸã‚ã«`SECURITY DEFINER`é–¢æ•°ã‚’ä½¿ç”¨:

1. **conversation_members SELECT** â†’ **conversation_memberså‚ç…§** = å†å¸°
   â†’ `user_conversation_ids()` SECURITY DEFINERé–¢æ•°ã§å›é¿
2. **conversations SELECT** â†’ **conversation_memberså‚ç…§** â†’ **conversation_members SELECT RLS** = å†å¸°
   â†’ `is_conversation_member()` SECURITY DEFINERé–¢æ•°ã§å›é¿
3. **messages SELECT** â†’ **conversation_memberså‚ç…§** â†’ åŒä¸Š
   â†’ `is_conversation_member()` SECURITY DEFINERé–¢æ•°ã§å›é¿

---

**æœ€çµ‚æ›´æ–°**: 2026-02-13
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 5.0.0ï¼ˆãƒ¡ãƒƒã‚»ãƒ³ã‚¸ãƒ£ãƒ¼æ©Ÿèƒ½è¿½åŠ ï¼‰
